#include <stdio.h>
#include "poly.h"
#include "dgt.h"
#include "reduce.h"

/* The k-th root of i and its inverse are multiplied by the Montgomery constant R = 2^32 mod p. */
static const int32_t nthroots[PARAM_N] = {172048372, 0, 1434709, 177968999, 287780494, 279344938, 271738881, 83016886, 83163822, 209360211, 188427846, 132375887, 130470001, 323818178, 323518295, 234378661, 124852299, 113452573, 294215575, 127527574, 82001452, 314433176, 73074059, 102233454, 160387913, 167809673, 154366428, 182718471, 298195235, 253218616, 56716202, 207699386, 171044489, 157933611, 241314879, 23097921, 240070418, 153816177, 160266374, 161495310, 163040406, 205592721, 75625184, 164312934, 244910468, 15947853, 242022064, 62189842, 35429011, 85513343, 280335051, 125904920, 293289457, 154771378, 13795105, 246667403, 334120350, 299226159, 43695767, 20627977, 122516611, 315598937, 208094185, 46314278, 265699953, 49358378, 23044582, 254383855, 235615227, 187512758, 326696604, 194230943, 29231056, 182414742, 192083167, 179325660, 97730681, 281025426, 113179103, 297342023, 338864252, 295849414, 150246896, 136029951, 281669312, 56441133, 91838844, 211674072, 86842953, 142277648, 312195023, 229607011, 99711198, 240040375, 282714229, 321888047, 104027568, 342606143, 217112104, 132126618, 12506598, 42648793, 97503667, 205813336, 27882847, 66972066, 106427817, 201341790, 73657135, 202231227, 154138061, 102056233, 100072727, 38057480, 77936991, 213778544, 342586003, 38808992, 227465834, 176719407, 301125291, 37588513, 83633677, 53453086, 289596987, 248396846, 262370955, 315765174, 245506333, 101196009, 60398399, 282414388, 1306404, 333238877, 159013692, 305288806, 46026992, 334322275, 47077221, 187931301, 284474863, 53881909, 83439966, 300056722, 237340964, 131511467, 307054604, 147023931, 80725341, 264174093, 307284577, 274300101, 33224632, 51517089, 88753638, 335047428, 31397531, 55266256, 118580249, 248565897, 193256600, 277344966, 29814103, 157959262, 108807463, 146725811, 20248794, 60012428, 60931567, 188463058, 86746095, 256706455, 327214552, 213234958, 122886989, 235041182, 87885236, 84992311, 204855052, 324175211, 216009034, 301063580, 305422536, 8968531, 269836783, 190632924, 82643854, 242411175, 324808661, 243683435, 146012093, 256547544, 262027281, 206851350, 16640880, 210385362, 34944462, 167843466, 227898091, 304297181, 151957306, 782795, 77828425, 48926866, 286090376, 79413189, 256152760, 287900856, 148836142, 86031177, 142203684, 69589058, 48323463, 328660341, 258157039, 168371988, 242032493, 146151390, 241953332, 64170500, 70365197, 25290364, 77646261, 63273752, 205009921, 27160476, 180316445, 64663262, 252552106, 40533956, 144219531, 28478881, 251092205, 148815612, 298661651, 154451100, 104553191, 234636469, 330352789, 30077150, 291941606, 191714048, 11194618, 258246153, 213275021, 271609628, 85698563, 213766207, 319826409, 82876269, 291828531, 173379413, 9623283, 315525079, 159275821, 16473510, 180323825, 93259136, 81667548, 88003072, 320647555, 89918461, 274156755, 178412101, 216930200, 42414195, 44757796, 149840693, 139627654, 276303581, 297720118, 203679077, 308472146, 195303531, 216658054, 275107348, 273457397, 132038113, 198611335, 151822420, 178892510, 137413126, 130051585, 90065309, 5891871, 78329299, 246030357, 333531781, 229969877, 112076068, 153509290, 209971624, 23903002, 161247643, 199708637, 107525644, 129864276, 222508210, 320308853, 327489967, 116377936, 295790258, 4707117, 265444030, 332169190, 193135082, 151686365, 101031099, 248697402, 318893846, 232452904, 64103297, 169537775, 250398280, 165265276, 213522514, 192778895, 51447516, 50643623, 58885847, 15872529, 102283481, 301696645, 96900432, 114206814, 231186732, 257684033, 76669307, 212868370, 34214241, 270549511, 183892743, 316398433, 215527422, 25398858, 280978753, 317127371, 5632782, 44538083, 116226418, 177428916, 248526847, 298044959, 83724701, 50465773, 250903472, 315314993, 104928007, 48344413, 157280020, 280551269, 2513406, 158875065, 229719204, 113207285, 96509829, 266755715, 164380131, 109963384, 82937946, 161630737, 176497710, 214803117, 168937703, 163533433, 29843207, 5140364, 322990276, 276129455, 293086750, 8425896, 108508, 100223350, 2943618, 175938654, 234079308, 33758788, 32174481, 328421736, 59869034, 6580491, 41609086, 262883807, 175502734, 195631866, 15387799, 109743467, 118589733, 150234404, 73337317, 223804448, 42972003, 72044123, 254227854, 333423075, 121264995, 289628747, 282662049, 10433519, 292295421, 231182125, 304064506, 165182942, 288195962, 146240284, 259489225, 217103250, 309968366, 73615365, 40175562, 264417822, 14788230, 160893683, 334448632, 249514123, 304403104, 24698250, 110089781, 259306873, 102858052, 197700153, 180125191, 267193530, 207610791, 113070913, 149507428, 60133059, 248779611, 55566025, 63848930, 221651077, 101197013, 127141857, 119533770, 23710950, 203263866, 300772349, 167241475, 83978451, 85414444, 298861292, 327889036, 70893322, 252681677, 38660530, 289219781, 152376691, 43373055, 327154907, 119917513, 169004898, 304794579, 71921897, 41335968, 242203463, 275855998, 321207075, 37982340, 270275818, 23676901, 255177376, 220711431, 100997035, 85826448, 299782211, 27689973, 74996301, 24950695, 7719178, 27349215, 162214346, 265620041, 283283705, 233666910, 212615980, 12097360, 238170966, 236796296, 289366730, 167536999, 274669703, 273379889, 210417056, 333114946, 167754737, 121898085, 142165945, 15992439, 232657683, 327181505, 9459891, 71231470, 80503401, 248645565, 237233243, 54856640, 185888591, 187544384, 241222121, 8982380, 146741658, 283583799, 311367611, 186391364, 193164647, 41751716, 332224164, 310932813, 228515099, 300094073, 200504386, 289253769, 256373736, 256373736, 315535967, 32048298, 191101508, 92360502, 26547589, 16843089, 317617501, 237145833, 180229467, 304519392, 40189638, 169941346, 200120113, 240853692, 170685555, 299539355, 13858298, 206785111, 340847494, 23988274, 286701914, 317393892, 131475952, 74954161, 28440066, 16652246, 30540799, 233209788, 84281881, 145351073, 289882426, 241658807, 35738312, 168681838, 301821567, 198567303, 16218300, 279476575, 102089006, 262558315, 193065221, 148145237, 199760786, 217228683, 125645860, 335395919, 177131763, 157975723, 44877544, 235648454, 79018269, 332533258, 304792999, 311491571, 67642906, 93924664, 42695337, 61023149, 138066446, 336653190, 178122527, 227496031, 30064722, 217125011, 48965974, 321823111, 80248313, 208499939, 151840251, 308382713, 222840533, 250954024, 224427998, 155405754, 281718529, 231161098, 134690741, 246087400, 85610003, 244691423, 27502857, 112033327, 87990407, 141575757, 209011929, 181515738, 115573352, 167457420, 292996546, 92594750, 209552903, 303044375, 237919905, 249281947, 1516488, 90215124, 147105848, 220069958, 68528207, 154346064, 243183442, 131061851, 199748925, 247404225, 257178061, 322242913, 337863536, 283950613, 72156663, 291469199, 77144143, 65052296, 191475960, 172512219, 257117026, 301255789, 191961457, 112614275, 23854400, 181942333, 44440159, 149796019, 292525317, 145471829, 51529107, 249273161, 82872172, 266201668, 105288819, 216842551, 3995633, 60057803, 146120705, 87486737, 304381617, 67451322, 89872908, 149999989, 99927987, 75525186, 110585278, 95741845, 139520645, 183199987, 249689539, 281837429, 135185076, 66994332, 240823131, 113875574, 331599434, 49997709, 220270564, 50150043, 298533837, 298807681, 262508585, 133569186, 126048696, 19235499, 306076297, 46174532, 73844568, 175498937, 247260381, 251591469, 213468562, 182830101, 199634781, 314385476, 68535029, 85190829, 202345228, 100652410, 152719615, 321120285, 221944533, 130976353, 160185568, 89326982, 9531503, 309174150, 23589030, 98439351, 97452326, 79407827, 282315154, 261917677, 116622847, 36156688, 305334844, 36228463, 280042428, 258607749, 36881084, 19859978, 257575464, 153065337, 138874071, 5006250, 300939956, 2475389, 329994709, 233069259, 177051911, 109727951, 176685864, 144758955, 247462854, 173277521, 111265554, 32785577, 177640683, 138045491, 259971394, 132259627, 266010231, 157392408, 238648861, 277416308, 44304237, 275365966, 273602181, 116419926, 220726233, 94045519, 343530333, 228285010, 339462635, 286277722, 279266703, 86111066, 94473788, 22813938, 236336292, 246852763, 145057673, 117905866, 81340440, 44208751, 77086121, 175057774, 98837138, 294052008, 129518771, 68347628, 333780601, 153933784, 71295846, 282340596, 197831977, 160639900, 292060742, 46783551, 250317441, 163252752, 289033157, 247823343, 263993816, 241862781, 82594169, 199100601, 7313051, 1570972, 297430106, 277365422, 219652960, 206213517, 74685038, 219650532, 130521181, 330268318, 68384358, 283147205, 161462652, 284455581, 130483398, 151009224, 190098526, 275049562, 330875849, 201827463, 177604459, 321274701, 335998363, 320137552, 102791629, 308879532, 184019664, 107651371, 265916094, 292311107, 278738189, 310612059, 168781840, 173728259, 197627384, 317041446, 290694158, 133069497, 306235120, 15532420, 193349175, 256251312, 314374799, 319337369, 101777679, 41649277, 23432258, 75624627, 147151660, 50740844, 40604616, 178361175, 163956856, 272611433, 18356894, 311087869, 262411836, 180193756, 186873244, 317612829, 329107568, 307921929, 83917080, 317477003, 137240030, 207555779, 156549877, 5848845, 117688831, 34996785, 227824696, 165524759, 66773224, 71875048, 291646391, 136435922, 284286474, 23169346, 15485274, 266646458, 137306403, 286537258, 281066590, 164328554, 220838613, 97065767, 43138769, 139685387, 222929258, 132075111, 26328976, 200723315, 60521211, 51080088, 170074642, 233932521, 89880681, 63145141, 165218937, 1846874, 84087346, 125215572, 233284758, 103052344, 141456262, 193641325, 267539407, 49588099, 58643113, 108411753, 28163636, 105556288, 88694302, 111953260, 18283836, 283686790, 3189681, 30077405, 203459237, 329143864, 281712992, 240222969, 298815361, 104351426, 254120402, 46674075, 30297458, 150186853, 269143177, 317304584, 70440302, 81233981, 209050181, 66603074, 308148184, 125855966, 106349202, 45939532, 303383693, 277135471, 245168125, 307766952, 217273321, 57535092, 175232819, 83389800, 291205931, 325400767, 284867497, 40211724, 47668556, 59549994, 223547617, 112914295, 226486960, 276480769, 61629442, 233255665, 31406350, 338227540, 234576069, 268130881, 248017875, 282641619, 147194006, 179160555, 141168222, 4045472, 336611142, 47410955, 201610273, 208095596, 70887644, 227760889, 42753630, 85410185, 210686601, 245313188, 79333804, 59725879, 205430918, 180164172, 331428896, 257183564, 175930138, 25913205, 104423664, 291214921, 43613266, 259353455, 57148276, 161614493, 253434580, 258700227, 255311342, 296576170, 285803046, 203576410, 253808873, 45223577, 29839848, 77522344, 125988462, 257038196, 47315565, 253567748, 245010510, 68390970, 166367028, 214213893, 33004675, 34930538, 57457056, 195817971, 181532484, 218689470, 147934949, 317124999, 325925196, 275169509, 274772623, 329353721, 321090280, 197174699, 299271371, 287635729, 89170626, 248407581, 106760074, 23688063, 20569755, 140925335, 104080493, 101807103, 88218526, 96677730, 44273290, 25069194, 210864895, 147094262, 25739384, 162706639, 43078799, 106066910, 116010540, 213718966, 153165025, 144171416};

static const int32_t invnthroots[1024] = {172048372, 0, 144171416, 190411552, 213718966, 227566037, 106066910, 300497778, 162706639, 317837193, 147094262, 132711682, 25069194, 299303287, 96677730, 255358051, 101807103, 239496084, 140925335, 323006822, 23688063, 236816503, 248407581, 254405951, 287635729, 44305206, 197174699, 22486297, 329353721, 68803954, 275169509, 17651381, 317124999, 195641628, 218689470, 162044093, 195817971, 286119521, 34930538, 310571902, 214213893, 177209549, 68390970, 98566067, 253567748, 296261012, 257038196, 217588115, 77522344, 313736729, 45223577, 89767704, 203576410, 57773531, 296576170, 88265235, 258700227, 90141997, 161614493, 286428301, 259353455, 299963311, 291214921, 239152913, 25913205, 167646439, 257183564, 12147681, 180164172, 138145659, 59725879, 264242773, 245313188, 132889976, 85410185, 300822947, 227760889, 272688933, 208095596, 141966304, 47410955, 6965435, 4045472, 202408355, 179160555, 196382571, 282641619, 95558702, 268130881, 109000508, 338227540, 312170227, 233255665, 281947135, 276480769, 117089617, 112914295, 120028960, 59549994, 295908021, 40211724, 58709080, 325400767, 52370646, 83389800, 168343758, 57535092, 126303256, 307766952, 98408452, 277135471, 40192884, 45939532, 237227375, 125855966, 35428393, 66603074, 134526396, 81233981, 273136275, 317304584, 74433400, 150186853, 313279119, 46674075, 89456175, 104351426, 44761216, 240222969, 61863585, 329143864, 140117340, 30077405, 340386896, 283686790, 325292741, 111953260, 254882275, 105556288, 315412941, 108411753, 284933464, 49588099, 76037170, 193641325, 202120315, 103052344, 110291819, 125215572, 259489231, 1846874, 178357640, 63145141, 253695896, 233932521, 173501935, 51080088, 283055366, 200723315, 317247601, 132075111, 120647319, 139685387, 300437808, 97065767, 122737964, 164328554, 62509987, 286537258, 206270174, 266646458, 328091303, 23169346, 59290103, 136435922, 51930186, 71875048, 276803353, 165524759, 115751881, 34996785, 225887746, 5848845, 187026700, 207555779, 206336547, 317477003, 259659497, 307921929, 14469009, 317612829, 156703333, 180193756, 81164741, 311087869, 325219683, 272611433, 179619721, 178361175, 302971961, 50740844, 196424917, 75624627, 320144319, 41649277, 241798898, 319337369, 29201778, 256251312, 150227402, 15532420, 37341457, 133069497, 52882419, 317041446, 145949193, 173728259, 174794737, 310612059, 64838388, 292311107, 77660483, 107651371, 159556913, 308879532, 240784948, 320137552, 7578214, 321274701, 165972118, 201827463, 12700728, 275049562, 153478051, 151009224, 213093179, 284455581, 182113925, 283147205, 275192219, 330268318, 213055396, 219650532, 268891539, 206213517, 123923617, 277365422, 46146471, 1570972, 336263526, 199100601, 260982408, 241862781, 79582761, 247823343, 54543420, 163252752, 93259136, 46783551, 51515835, 160639900, 145744600, 282340596, 272280731, 153933784, 9795976, 68347628, 214057806, 294052008, 244739439, 175057774, 266490456, 44208751, 262236137, 117905866, 198518904, 246852763, 107240285, 22813938, 249102789, 86111066, 64309874, 286277722, 4113942, 228285010, 46244, 94045519, 122850344, 116419926, 69974396, 275365966, 299272340, 277416308, 104927716, 157392408, 77566346, 132259627, 83605183, 138045491, 165935894, 32785577, 232311023, 173277521, 96113723, 144758955, 166890713, 109727951, 166524666, 233069259, 13581868, 2475389, 42636621, 5006250, 204702506, 153065337, 86001113, 19859978, 306695493, 258607749, 63534149, 36228463, 38241733, 36156688, 226953730, 261917677, 61261423, 79407827, 246124251, 98439351, 319987547, 309174150, 334045074, 89326982, 183391009, 130976353, 121632044, 321120285, 190856962, 100652410, 141231349, 85190829, 275041548, 314385476, 143941796, 182830101, 130108015, 251591469, 96316196, 175498937, 269732009, 46174532, 37500280, 19235499, 217527881, 133569186, 81067992, 298807681, 45042740, 50150043, 123306013, 49997709, 11977143, 113875574, 102753446, 66994332, 208391501, 281837429, 93887038, 183199987, 204055932, 95741845, 232991299, 75525186, 243648590, 149999989, 253703669, 67451322, 39194960, 87486737, 197455872, 60057803, 339580944, 216842551, 238287758, 266201668, 260704405, 249273161, 292047470, 145471829, 51051260, 149796019, 299136418, 181942333, 319722177, 112614275, 151615120, 301255789, 86459551, 172512219, 152100617, 65052296, 266432434, 291469199, 271419914, 283950613, 5713041, 322242913, 86398516, 247404225, 143827652, 131061851, 100393135, 154346064, 275048370, 220069958, 196470729, 90215124, 342060089, 249281947, 105656672, 303044375, 134023674, 92594750, 50580031, 167457420, 228003225, 181515738, 134564648, 141575757, 255586170, 112033327, 316073720, 244691423, 257966574, 246087400, 208885836, 231161098, 61858048, 155405754, 119148579, 250954024, 120736044, 308382713, 191736326, 208499939, 263328264, 321823111, 294610603, 217125011, 313511855, 227496031, 165454050, 336653190, 205510131, 61023149, 300881240, 93924664, 275933671, 311491571, 38783578, 332533258, 264558308, 235648454, 298699033, 157975723, 166444814, 335395919, 217930717, 217228683, 143815791, 148145237, 150511356, 262558315, 241487571, 279476575, 327358277, 198567303, 41755010, 168681838, 307838265, 241658807, 53694151, 145351073, 259294696, 233209788, 313035778, 16652246, 315136511, 74954161, 212100625, 317393892, 56874663, 23988274, 2729083, 206785111, 329718279, 299539355, 172891022, 240853692, 143456464, 169941346, 303386939, 304519392, 163347110, 237145833, 25959076, 16843089, 317028988, 92360502, 152475069, 32048298, 28040610, 256373736, 87202841, 289253769, 143072191, 300094073, 115061478, 310932813, 11352413, 41751716, 150411930, 186391364, 32208966, 283583799, 196834919, 8982380, 102354456, 187544384, 157687986, 54856640, 106343334, 248645565, 263073176, 71231470, 334116686, 327181505, 110918894, 15992439, 201410632, 121898085, 175821840, 333114946, 133159521, 273379889, 68906874, 167536999, 54209847, 236796296, 105405611, 12097360, 130960597, 233666910, 60292872, 265620041, 181362231, 27349215, 335857399, 24950695, 268580276, 27689973, 43794366, 85826448, 242579542, 220711431, 88399201, 23676901, 73300759, 37982340, 22369502, 275855998, 101373114, 41335968, 271654680, 304794579, 174571679, 119917513, 16421670, 43373055, 191199886, 289219781, 304916047, 252681677, 272683255, 327889036, 44715285, 85414444, 259598126, 167241475, 42804228, 203263866, 319865627, 119533770, 216434720, 101197013, 121925500, 63848930, 288010552, 248779611, 283443518, 149507428, 230505664, 207610791, 76383047, 180125191, 145876424, 102858052, 84269704, 110089781, 318878327, 304403104, 94062454, 334448632, 182682894, 14788230, 79158755, 40175562, 269961212, 309968366, 126473327, 259489225, 197336293, 288195962, 178393635, 304064506, 112394452, 292295421, 333143058, 282662049, 53947830, 121264995, 10153502, 254227854, 271532454, 42972003, 119772129, 73337317, 193342173, 118589733, 233833110, 15387799, 147944711, 175502734, 80692770, 41609086, 336996086, 59869034, 15154841, 32174481, 309817789, 234079308, 167637923, 2943618, 243353227, 108508, 335150681, 293086750, 67447122, 322990276, 338436213, 29843207, 180043144, 168937703, 128773460, 176497710, 181945840, 82937946, 233613193, 164380131, 76820862, 96509829, 230369292, 229719204, 184701512, 2513406, 63025308, 157280020, 295232164, 104928007, 28261584, 250903472, 293110804, 83724701, 45531618, 248526847, 166147661, 116226418, 299038494, 5632782, 26449206, 280978753, 318177719, 215527422, 27178144, 183892743, 73027066, 34214241, 130708207, 76669307, 85892544, 231186732, 229369763, 96900432, 41879932, 102283481, 327704048, 58885847, 292932954, 51447516, 150797682, 213522514, 178311301, 250398280, 174038802, 64103297, 111123673, 318893846, 94879175, 101031099, 191890212, 193135082, 11407387, 265444030, 338869460, 295790258, 227198641, 327489967, 23267724, 222508210, 213712301, 107525644, 143867940, 161247643, 319673575, 209971624, 190067287, 112076068, 113606700, 333531781, 97546220, 78329299, 337684706, 90065309, 213524992, 137413126, 164684067, 151822420, 144965242, 132038113, 70119180, 275107348, 126918523, 195303531, 35104431, 203679077, 45856459, 276303581, 203948923, 149840693, 298818781, 42414195, 126646377, 178412101, 69419822, 89918461, 22929022, 88003072, 261909029, 93259136, 163252752, 16473510, 184300756, 315525079, 333953294, 173379413, 51748046, 82876269, 23750168, 213766207, 257878014, 271609628, 130301556, 258246153, 332381959, 191714048, 51634971, 30077150, 13223788, 234636469, 239023386, 154451100, 44914926, 148815612, 92484372, 28478881, 199357046, 40533956, 91024471, 64663262, 163260132, 27160476, 138566656, 63273752, 265930316, 25290364, 273211380, 64170500, 101623245, 146151390, 101544084, 168371988, 85419538, 328660341, 295253114, 69589058, 201372893, 86031177, 194740435, 287900856, 87423817, 79413189, 57486201, 48926866, 265748152, 782795, 191619271, 304297181, 115678486, 167843466, 308632115, 210385362, 326935697, 206851350, 81549296, 256547544, 197564484, 243683435, 18767916, 242411175, 260932723, 190632924, 73739794, 8968531, 38154041, 301063580, 127567543, 324175211, 138721525, 84992311, 255691341, 235041182, 220689588, 213234958, 16362025, 256706455, 256830482, 188463058, 282645010, 60012428, 323327783, 146725811, 234769114, 157959262, 313762474, 277344966, 150319977, 248565897, 224996328, 55266256, 312179046, 335047428, 254822939, 51517089, 310351945, 274300101, 36292000, 264174093, 262851236, 147023931, 36521973, 131511467, 106235613, 300056722, 260136611, 53881909, 59101714, 187931301, 296499356, 334322275, 297549585, 305288806, 184562885, 333238877, 342270173, 282414388, 283178178, 101196009, 98070244, 315765174, 81205622, 248396846, 53979590, 53453086, 259942900, 37588513, 42451286, 176719407, 116110743, 38808992, 990574, 213778544, 265639586, 38057480, 243503850, 102056233, 189438516, 202231227, 269919442, 201341790, 237148760, 66972066, 315693730, 205813336, 246072910, 42648793, 331069979, 132126618, 126464473, 342606143, 239549009, 321888047, 60862348, 240040375, 243865379, 229607011, 31381554, 142277648, 256733624, 211674072, 251737733, 56441133, 61907265, 136029951, 193329681, 295849414, 4712325, 297342023, 230397474, 281025426, 245845896, 179325660, 151493410, 182414742, 314345521, 194230943, 16879973, 187512758, 107961350, 254383855, 320531995, 49358378, 77876624, 46314278, 135482392, 315598937, 221059966, 20627977, 299880810, 299226159, 9456227, 246667403, 329781472, 154771378, 50287120, 125904920, 63241526, 85513343, 308147566, 62189842, 101554513, 15947853, 98666109, 164312934, 267951393, 205592721, 180536171, 161495310, 183310203, 153816177, 103506159, 23097921, 102261698, 157933611, 172532088, 207699386, 286860375, 253218616, 45381342, 182718471, 189210149, 167809673, 183188664, 102233454, 270502518, 314433176, 261575125, 127527574, 49361002, 113452573, 218724278, 234378661, 20058282, 323818178, 213106576, 132375887, 155148731, 209360211, 260412755, 83016886, 71837696, 279344938, 55796083, 177968999, 342141868};

void poly_dgt(poly x_dgt, const poly x)
{ /* In this implementation, although the data type is a signed integer, we represent the coefficients in the 
   * interval of [0, ..., PARAM_Q-1] since we compare the output with the Python implementation. 
   * This is done by performing the subtraction (A - B) as (A + (2*PARAM_Q - B). 
  */

  int i, j;

  j = 0;
  for(i = 0; i < PARAM_N; i += 2) {             
      x_dgt[i] = barr_reduce64(
      reduce((int64_t)x[j] * nthroots[i]) + 
      (2*PARAM_Q - reduce((int64_t)x[512+j] * nthroots[i+1]))
      );
      
      x_dgt[i+1] = barr_reduce64(
      reduce((int64_t)x[j] * nthroots[i+1]) + 
      reduce((int64_t)x[512+j] * nthroots[i])
      );

      j++;
  } 

  dgt(x_dgt);

}


void poly_mul(poly result, const poly poly_a, const poly poly_b)
{
  
  poly mul, aux;
  int i, j;

  /* Since the input polynomials aren't multiplied by R, we multiply one of them by RÂ². A factor 
   * R is removed in this first call to the reduce() procedure. */
  for(i = 0; i < PARAM_N; ++i)
    aux[i] = barr_reduce64(reduce((int64_t)poly_b[i] * 216523736)); // R^2 mod p s.t. R = 2^32 mod p

  /* At this point, the elements in the vector aux[] are multiplied by R. Then, the 
   * exact value for the integer multiplication is obtained when calling the reduce() procedure.
  */
  /* Also, notice that both polynomials were folded previously in the poly_dgt procedure. */
  for(i = 0; i < PARAM_N; i += 2) {             
    mul[i] = barr_reduce64(
      reduce((int64_t)poly_a[i] * aux[i]) + 
      (2*PARAM_Q - reduce((int64_t)poly_a[i+1] * aux[i+1]))
    );

    mul[i+1] = barr_reduce64(
      reduce((int64_t)poly_a[i] * aux[i+1]) + 
      reduce((int64_t)poly_a[i+1] * aux[i])
    );
  }

  /* Recovering the multiplication result in Z[x]/<x^n+1> */
  idgt(mul);

  /* Removing the twisting factors and writing the result from the Gaussian integer to the polynomial form */
  j = 0;
  for(i = 0; i < PARAM_N; i += 2) {
      result[j] = barr_reduce64(
               reduce((int64_t)mul[i] * invnthroots[i]) + (2*PARAM_Q -
               reduce((int64_t)mul[i+1] * invnthroots[i+1]))
               );

      result[j+512] = barr_reduce64(
               reduce((int64_t)mul[i] * invnthroots[i+1]) + 
               reduce((int64_t)mul[i+1] * invnthroots[i])
               );
      j++;
  }

}