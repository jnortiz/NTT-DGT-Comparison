/*************************************************************************************
* qTESLA: an efficient post-quantum signature scheme based on the R-LWE problem
*
* Abstract: NTT, modular reduction and polynomial functions
**************************************************************************************/

#include "poly.h"
#include "sha3/fips202.h"
#include "api.h"

static const int32_t nthroots[PARAM_N] = {14237691, 0, 813300761, 595601658, 407525072, 848902196, 607407728, 851168526, 809621772, 729861076, 275189923, 572797538, 178023018, 514880168, 200893069, 597130604, 810906230, 431504802, 505049599, 467936548, 489113846, 303905830, 333408644, 569458541, 121716645, 90834763, 616354630, 335555324, 51399256, 499024032, 314869382, 458598262, 458255511, 223462570, 113053902, 184622338, 134656578, 483650372, 435641119, 98248520, 526837692, 445101647, 453167747, 146932128, 277410548, 522953413, 434463510, 344760440, 294529412, 657005812, 514821683, 145291371, 687285299, 775115216, 774813945, 171168337, 721774771, 691403583, 333235202, 676333641, 345631198, 337126892, 361387135, 636682344, 734842325, 748627919, 388692673, 140798464, 428430358, 543387519, 605790448, 436984585, 735583197, 328338931, 275091180, 451863826, 428597002, 584118892, 212266863, 494086541, 294793033, 27098865, 79947695, 263366841, 65484629, 124461948, 826383106, 851885648, 687746044, 312150869, 577273332, 123542396, 731426015, 152934288, 660843937, 692983973, 185185748, 8956768, 148340660, 775120445, 551504237, 95705763, 297800962, 246477808, 189077738, 602396368, 731415301, 598924840, 284391547, 563143512, 186714899, 200039126, 40727804, 32389056, 747292184, 489103625, 722574239, 82990895, 848012377, 52299291, 595794428, 482889525, 697495918, 4900705, 552953359, 535913322, 812467179, 199467854, 592694717, 851678759, 290267533, 521414158, 453959958, 121008785, 514445207, 35422341, 32490637, 68203891, 553463843, 47400168, 623493991, 788320520, 141175161, 91245754, 10351037, 150497434, 146559443, 86598977, 363815412, 774948541, 818596689, 509610364, 420834125, 295302968, 661025924, 541859815, 591293654, 491322532, 515795749, 587877559, 157391892, 362824311, 354942633, 19961695, 797016079, 471712280, 731985958, 490485764, 846708645, 580653333, 561186229, 787726214, 283426080, 199063710, 402843175, 786994072, 636145198, 72183582, 154310022, 340868571, 126541741, 811868379, 3729877, 498603345, 572355640, 171027181, 471416965, 227639171, 446895934, 276029341, 664805494, 824139265, 269762512, 752596548, 317800920, 25827657, 545136674, 592392303, 746887563, 680283378, 611113128, 800413236, 131283111, 453857976, 839542358, 379570207, 127655361, 365362555, 94272703, 630617082, 577401368, 153323260, 326102624, 636273395, 633223678, 197612203, 283623804, 474001809, 664881597, 350706990, 73855069, 813747364, 838596742, 826036768, 480296412, 824940060, 133014313, 260727454, 8541629, 390715330, 82532002, 481593305, 264772788, 732299379, 382262837, 126643535, 150221222, 671039716, 701333980, 695060340, 197986534, 508845674, 811289437, 677457105, 77039616, 724762082, 361698294, 652413728, 39251821, 396743915, 819262568, 136219927, 156242272, 772734800, 847728379, 276191429, 646767621, 747502032, 26064067, 843952711, 668856340, 442003790, 633643281, 196061328, 282973082, 152800602, 411626725, 408726657, 777583104, 367657823, 52041584, 843379097, 526906981, 262862483, 257092001, 262424963, 837988718, 772946649, 17434568, 589480159, 307080779, 763781809, 514795733, 332894733, 180678973, 477219585, 575565820, 641281855, 138411426, 471106580, 152085268, 219163357, 396906988, 48112001, 93831428, 288868982, 503164278, 698802211, 762057991, 37382249, 178117947, 629454928, 301826460, 144371465, 108293454, 596676834, 116067928, 149886202, 623570341, 115631316, 609776949, 99722527, 131603902, 718281132, 715703204, 257356661, 321385754, 457961319, 194617835, 346670959, 808185638, 307104334, 832275945, 152595242, 60115258, 625684170, 143650678, 112571001, 777644970, 807242329, 795069162, 799826819, 460860798, 320314081, 634493159, 309573844, 328245658, 562041052, 141307503, 298940288, 827237346, 110393131, 96655101, 654694895, 625370768, 595545679, 840960269, 174416122, 661695131, 288012832, 851963518, 397514504, 835251552, 44973149, 38120243, 778988181, 824605297, 839531941, 317906853, 49173163, 77579987, 525274878, 424520880, 423015328, 50117942, 733436464, 566696769, 220307479, 483859045, 484530557, 349565119, 706964721, 722447637, 166637410, 147488114, 20476929, 225995969, 280263839, 802858670, 728136440, 247898256, 153053274, 695568603, 21796081, 659182882, 332017057, 9934680, 173595852, 84187280, 809388663, 226847467, 557733887, 98402633, 251026378, 305602049, 265909575, 295894327, 235870999, 90599095, 778541482, 600054600, 808316379, 828423555, 600840253, 337130921, 384250133, 154684506, 95606547, 602542589, 319523120, 828954731, 152825082, 66688447, 840031080, 375578731, 668314369, 642794596, 58327893, 65543142, 648565626, 140074197, 223885213, 855063815, 36049490, 360778057, 319539565, 254047933, 71489045, 556731982, 660649526, 191771935, 457080291, 662478712, 450692054, 686696593, 758418515, 344524808, 825170489, 18314759, 290174327, 136024415, 848987976, 411605048, 774285350, 359047348, 832943959, 480783139, 693406490, 848789401, 751059614, 112088622, 108537023, 533662462, 35434178, 332573806, 693588471, 530801753, 617478428, 694487164, 378544794, 168161113, 454305750, 708382955, 468101785, 119434237, 211000260, 670461795, 275288046, 585424345, 426686277, 721304497, 606134028, 616368386, 184326469, 239645549, 242247246, 168708229, 219239483, 627150213, 593220072, 132868093, 431061893, 774126367, 39124915, 360375485, 14809402, 1637072, 56119021, 369251843, 218767443, 112231232, 852673316, 750301959, 450586213, 562261808, 168023793, 810441462, 768899659, 825048623, 96678879, 217117817, 168882049, 512135019, 467616296, 761086474, 156026697, 382853504, 635461229, 787230759, 627141062, 641472042, 618787746, 563725905, 447339671, 340047686, 709878593, 482990710, 485111198, 843781606, 683257235, 817905448, 22340541, 288022015, 218368379, 198221995, 794835238, 823132593, 170453636, 90088221, 400153438, 168200003, 828448460, 583204734, 752891368, 402441535, 301985511, 75386887, 538133647, 503603508, 188910080, 92433716, 439198181, 826114919, 231858129, 299201860, 605824108, 352513449, 846682571, 195984052, 86984579, 351847267, 639635527, 54037345, 560624973, 218829202, 564807361, 310959600, 658998024, 487138154, 439220036, 713562110, 665655661, 365832376, 572822607, 700736320, 135040432, 493300115, 706825694, 258055987, 300052616, 328031965, 228182299, 697248001, 602618099, 582508232, 285655457, 152217311, 422659523, 615581341, 778828394, 208042895, 60275945, 830404897, 676774927, 845407608, 365801678, 312113725, 218963370, 14502071, 766292360, 85116761, 480970275, 257288224, 52051147, 69764643, 317455094, 532016197, 30268799, 379916867, 15438746, 814025702, 688477528, 84890123, 468232642, 65993043, 592138691, 452331340, 61648438, 541299769, 224180777, 681854333, 32523522, 467773359, 678248417, 501757228, 379035134, 417425961, 138131820, 404523459, 24407089, 43178406, 159342880, 618883526, 157321263, 279393482, 340682023, 280927139, 437281990, 189779700, 87153129, 39335649, 758490888, 762595330, 853135748, 475095608, 501666590, 283371585, 359601468, 283999073, 72738036, 365241762, 141824875, 855692368, 252664068, 711522390, 578688703, 584105007, 390987669, 324428722, 661212930, 698162825, 516291382, 326255730, 265258888, 787189695, 699883609, 309764247, 838981748, 607628453, 312513003, 695598674, 511809256, 716918110, 610970679, 15362488, 748910900, 372628856, 621830001, 42053238, 621942034, 656978935, 71843781, 518663264, 790031730, 289409473, 676743016, 303902987, 505124498, 623710661, 656699346, 80680480, 65279717, 164270111, 114728024, 671193954, 34250316, 630336633, 536293034, 601460438, 363911309, 442550005, 759258105, 478492963, 624002030, 852333593, 596019036, 359607193, 277281719, 802505645, 332708826, 322087336, 712710791, 629930121, 101802248, 251306349, 92093016, 298148204, 95157338, 526511836, 311119399, 303749331, 165796619, 781779687, 672240074, 710218360, 509407554, 376748929, 369459133, 678418689, 626212203, 163926559, 189267025, 450886325, 751536728, 434799614, 853365396, 728241341, 291711284, 15016157, 378030159, 174704763, 555840504, 753995397, 785243472, 24230831, 697855469, 675185437, 65532235, 61589685, 854629430, 407427743, 318639159, 777433234, 218370155, 44805759, 90910595, 352708106, 240807945, 302711233, 79197155, 410918850, 733665787, 493357115, 456397238, 301624367, 335784098, 135145737, 330945593, 134431810, 252034348, 528607612, 578496106, 603409655, 555440544, 607628113, 642606055, 160014270, 128696577, 761163320, 840512462, 408227518, 715273626, 507957708, 732262647, 461567526, 494510889, 541158897, 731724068, 790696548, 191128405, 12292599, 816335902, 494900447, 512677958, 594071781, 742407314, 285198172, 528129539, 647622900, 48225744, 312182826, 297420371, 776809397, 197866006, 236313573, 5690282, 480316501, 469190609, 437934561, 153483825, 186963801, 302284620, 249485753, 437862621, 524719802, 134191874, 275694844, 243655628, 64532644, 569913749, 30179578, 836055661, 648068423, 323845761, 577904350, 331356187, 844618808, 450870806, 161797824, 387793786, 441225088, 705321725, 109230939, 532127493, 596486006, 333235427, 855819841, 404018939, 294412272, 850436251, 62535488, 427723714, 24500924, 446972087, 33303623, 177808448, 599700660, 828287680, 559379852, 486047915, 765501685, 172832997, 800365353, 735058075, 614801410, 809321164, 158869045, 832521250, 413182252, 354788622, 153218680, 852726530, 708362652, 477864299, 576524180, 63892834, 668361130, 694097529, 130924881, 66878045, 499447006, 243919998, 682267473, 12161711, 812345858, 796409724, 95556069, 126107173, 546221502, 499947038, 371811654, 57650608, 238247824, 567207929, 527857516, 841749546, 201081505, 521260726, 702470332, 598969271, 563224741, 403310138, 483085805, 513489397, 578552255, 14232414, 372215478, 324548410, 297730492, 676437540, 169148954, 740056205, 829987238, 13528743, 825380025, 512094436, 396276588, 800444437, 85951283, 56863932, 687264975, 311532796, 19183142, 126589302, 561805260, 795400887, 702415592, 433011533, 453428604, 507538885, 510544808, 834185466, 303362564, 403094690, 761829762, 619036558, 778971186, 499973333, 389235086, 380592205, 454407654, 75441873, 851080856, 775814616, 537437142, 398600921, 827132778, 331000355, 17400376, 530082045, 576072339, 570531508, 451436968, 85990122, 174659587, 487427403, 111417250, 823768695, 577346535, 227717972, 757166483, 66552210, 478376199, 394066795, 591645670, 261085881, 384475477, 224711477, 411260478, 656141692, 678499265, 492272643, 244870894, 449552672, 453561504, 53625987, 760762185, 257822790, 589691377, 631050982, 552942130, 280712484, 329174389, 456645627, 104380840, 175245982, 461742134, 493765616, 691100536, 605582228, 735191056, 211712977, 179398429, 32243030, 709493762, 632600267, 336103183, 261097518, 350235775, 617930264, 513507312, 121162612, 244818316, 480272584, 778294713, 712346281, 249555583, 693672945, 114316330, 720961401, 48920010, 487184997, 838486978, 276945452, 636247089, 128771559, 542631561, 344460745, 395083927, 88698517, 595642745, 482394707, 317337215, 392992551, 241196815, 438346842, 800674809, 531700483, 665553672, 665319319, 13053922, 321411531, 134969879, 133094351, 608036254, 788575695, 159712699, 308941691, 64272874, 231652955, 692002743, 676481248, 777330962, 24387139, 523539537, 332606384, 114553529, 425383809, 476095120, 774135637, 300737077, 537293646, 76880618, 291365016, 654129500, 470910123, 506201105, 456881350, 849524941, 688643350, 23830548, 430282502, 162199447, 667941441, 43453337, 662308004, 786692452, 117272152, 731767169, 849917212, 317175248, 643186278, 563678972, 602786574, 491038701, 254311273, 795916872, 588033065, 173027155, 267452476, 783962518, 558759045, 637473031, 691624784, 487590316, 763579278, 238464054, 822521186, 482568515, 759584155, 484535959, 673820582, 1123117, 165837018, 625622809, 550649871, 250453424, 192756688, 148658641, 218707715, 148654273, 666072340, 157828370, 455637524, 749028977, 697343656, 615899482, 848796190, 540075299, 334211629, 617835705, 596681067, 347111995, 366974109, 588934243, 668783139, 373098489, 743591835, 489003236, 231250773, 540388795, 846986458, 554481638, 317793853, 554704739, 611002744, 339155911, 447408600, 173598325, 771183109, 170763151, 448363529, 844131444, 207230287, 36642724, 286302930, 523859892, 477419155, 777223595, 676816184, 342005041, 294509202, 475028716, 231110798, 598670731, 191355759, 224622735, 236786748, 5372511, 420758113, 713727629, 759525501, 530812097, 588955240, 848497752, 340632122, 754521724, 627612006, 754551486, 398163840, 242596429, 271746121, 394547314, 636174888, 246123528, 227955342, 696128954, 405205656, 237683361, 125705662, 23591338, 849326939, 178997294, 406679121, 485784349, 795863822, 389602685, 109087385, 742284935, 234876145, 188914434, 685200807, 206569719, 287170978, 625656419, 522358397, 682960494, 305314638, 398734703, 623050239, 680353, 176285845, 304779849, 59634507, 307288395, 611286980, 592857320, 252049456, 799898521, 497661797, 701527784, 4769429, 168755713, 556219299, 604741135, 487019623, 566497562, 568891063, 103074310, 144697859, 274592764, 102887395, 135124165, 599873779, 853026969, 742098622, 378348376, 75105575, 403963992, 725547650, 34318286, 43346573, 192432086, 618530680, 579042648, 734953136, 499178986, 26051074, 583647951, 294039660, 44905483, 727063898, 713699443, 279349964, 594290587, 332199921, 423240262, 512996688, 653072395, 541229761, 709094550, 41216294, 77079932, 158247274, 83029844, 521696570, 747835688, 742564137, 435986733, 61003407, 171020523, 746605636, 369788742, 398319887, 727205640, 453763652, 166052763, 727457094, 527709607, 130628307, 704947797, 64313322, 245139879, 503408349, 146346210, 124136179, 138937912, 275840074, 703601009, 754306144, 445935355, 266738324, 749204031, 292232566, 824329442, 427674087, 558867511, 635358015, 842851321, 76253659, 490119898, 231966725, 349234745, 757247672, 212826973, 644424514, 349836370, 172426238, 434003685, 312019227, 851501558, 303818932, 382313474, 824436971, 766820309, 217803955, 638636139, 658888152, 507632026, 304093911, 113251712, 230861729, 168759129, 294706176, 665981010, 603497579, 550888336, 418803440, 229718271, 434429861, 754883558, 395362976, 312605673, 719556666, 659951059, 290523178, 219247302, 690694659, 205238663, 205822869, 154646830, 587267977, 369668239, 209020888, 701863157, 527773754, 33461431, 824205575, 673120900, 226679115, 653239713, 650407358, 319585940, 605470677, 641630398, 686911310, 255313014, 540465252, 586180420, 428575571, 142915829, 216978055, 821305256, 688101831, 844113231, 355264155, 344453584, 40405141, 346526471, 666972608, 344210210, 170446649, 431575229, 394144557, 12075461, 818559044, 369088108, 594588722, 712939145, 460954735, 433949711, 182479756, 92489075, 365753700, 583513632, 496484712, 177493060, 254529242, 38744647, 628580104, 444645770, 331673100, 200627070, 312772806, 400701780, 408286697, 286931740, 557155652, 771012590, 356742999, 180187748, 247906259, 588188382, 807452791, 753028201, 545319079, 121640840, 529064293, 63245561, 581052196, 92778652, 552485358, 226680397, 427761664, 434820263, 48270438, 602193587, 272490404, 256726322, 421792242, 204988136, 735168443, 453024772, 173540425, 547089269, 417516607, 773367723, 620266940, 59196630, 228631970, 186958935, 164637745, 730630552, 744221296, 709073449, 224606934, 308018750, 245890056, 464829496, 64031208, 43404297, 175021614, 79693952, 290058705, 441275469, 312700698, 271063216, 220360365, 194308801, 371514608, 312457962, 385590454, 625886928, 75589048, 186424507, 652872403, 569785780, 110364480, 152564617, 18107042, 58206125, 798834962, 19397728, 133397500, 802420463, 854394079, 851568793, 708456490, 467868474, 204064579, 480366586, 827531813, 5490741, 766296514, 516890188, 526458686, 48406102, 374798456, 139453845, 271166318, 817375069, 413407970, 207668040, 111720596, 480402159, 305132364, 146301537, 834228787, 566007359, 680498607, 224282744, 808587677, 472028919, 270986444, 405551775, 219081957, 162115629, 619251110, 63177890, 803407655, 749984650, 559030581, 506159751, 805456769, 550544540, 720437124, 220622826, 302713030, 285538820, 422438788, 197890003, 249113281, 769846430, 618780860, 298708749, 505677168, 278694070, 416890021, 169539334, 215221996, 544588322, 325211796, 315560912, 848515097, 244081734, 141801614, 724227821, 821190600, 439921222, 21548342, 181361420, 322012060, 309203797, 720852577, 433588081, 409056245, 166589341, 74993069, 573348059, 95814109, 425829782, 681171046, 260146915, 152816876, 668894200, 257585802, 672454155, 722334477, 505750285, 344707585, 824192867, 312834146, 187256652, 219086768, 827187592, 335241103, 775409863, 177442266, 347778930, 148257403, 512325146, 51341516, 276126272, 476711855, 475488455, 606117057, 534057587, 419862817, 848304689, 78812807, 789354390, 101730751, 306937241, 435118523, 27816287, 345430200, 169037658, 276651033, 434866461, 525973566, 525052695, 522887288, 643866994, 601310206, 492588784, 608421012, 342541806, 55973274, 570573434, 283559284, 608148758, 796856632, 816020595, 779155344, 554368401, 836619369, 178379809, 21337341, 304443413, 711809164, 270059629, 127865763, 53590983, 565448654, 51563976, 27033619, 837844025, 131657130, 81168928, 146346716, 307166148, 324825620, 762718469, 814063877, 717351885, 797217583, 413912122, 715533560, 748426469, 618510102, 849855518, 406823292, 430531362, 503859958, 616243804, 518730370, 650873306, 93148565, 427492059, 747134052, 227085051, 28698250, 570308428, 333324719, 534371873, 441285077, 439906309, 290009633, 791199587, 119626439, 561846649, 807945549, 195798476, 482082814, 460110553, 34814869, 232883248, 821268295, 627100634, 137643691, 181547552, 666340768, 422444231, 535843786, 282299485, 320251383, 257409600, 772649777, 70120246, 723006283, 253194434, 404230408, 710792274, 147308598, 554105990, 412172842, 620118906, 465913624, 762047206, 193038595, 339249753, 61007685, 661399847, 455052907, 257836206, 688710388, 565331863, 494846384, 847079117, 801706989, 116426543, 710189628, 100622334, 425818799, 175382583, 574230428, 717934220, 834925834, 744640972, 463300105, 500281889, 66903386, 178850275, 524771467, 778132372, 354570498, 523531337, 838753570, 398469701, 423693203, 673903628, 305145673, 110895483, 657441237, 104948314, 417512722, 229896085, 764283925, 467128594, 811140938, 646534556, 645496280, 796892420, 145213805, 810456584, 83423721, 673289614, 335142691, 728458653, 836352052, 726597704, 274996697, 773565616, 748080049, 239431224, 166452926, 738924722, 215221436, 83752909, 532949426, 253605701, 674088641, 102082179, 65125518, 632020797, 606711327, 636990754, 61348765, 704624746, 393876658, 35007574, 456547355, 502696746, 669860621, 299637347, 38145020, 813005202, 142168339, 767783488, 408073190, 556291573, 247639328, 737514711, 314125592, 20324057, 93911348, 689077915, 771204774, 641074794, 21527889, 320297464, 78985249, 380349542, 119639139, 448211552, 299636291, 337649291, 504167693, 183422039, 675518790, 512716138, 527851346, 373532229, 598279805, 771551785, 44034051, 706117016, 114656698, 674023537, 87598832, 845991155, 680310493, 258372219, 479887916, 356862883, 803096531, 390028443, 134529132, 416470942, 812173282, 397384387, 760660049, 644157136, 235583131, 766727898, 695664929, 52325753, 738337435, 283082770, 234778551, 255612879, 814099652, 254463216, 836837634, 740330203, 88166716, 110403392, 543927909, 777089980, 485750253, 15455037, 122551566, 674396495, 76777650, 217804416, 329694849, 698939896, 331065125, 99831947, 501692141, 91906685, 133956563, 189130653, 230330815, 179309542, 816015784, 140896649, 690973718, 798842723, 612151015, 760050780, 181478615, 89797364, 386839320, 114095326, 159188613, 768902497, 184525303, 102721651, 584004018, 711776313, 623305602, 164940579, 77145676, 494765486, 568524216, 695702173, 293467426, 755224463, 94735225, 594352319, 90225375, 266188710, 544718879, 281997680, 389641140, 541424187, 755785134, 407329487, 354844756, 763257771, 344630571, 532020392, 74226341, 87789105, 749476066, 454944076, 672120424, 818088475, 808254974, 126234482, 829391978, 735556408, 56595631, 165852935, 720441489, 640571274, 782591179, 43405455, 238088372, 609810860, 257874274, 111692893, 279568223, 308860504, 796984752, 548707962, 206161309, 718155062, 753322047, 562641921, 667074065, 467292197, 187257259, 387669172, 75941223, 153647076, 819409264, 102048546, 178917088, 12398773, 53380124, 38986036, 404369559, 133890511, 73458333, 706012505, 118847843, 427921877, 199467110, 34825769, 79075158, 481465128, 594299820, 71110399, 724145463, 223747943, 220215835, 352628309, 582263534, 601989583, 754817100, 469206725, 55650273, 610374486, 171564435, 485443717, 390798060, 296783632, 762749587, 254543289, 591841008, 782766779, 57822698, 448198124, 487747036, 336594170, 421598137, 740417161, 667778994, 485821820, 388265554, 243071136, 285805535, 640040568, 743651711, 143319203, 671729991, 383080127, 791251, 807718978, 527887761, 721873327, 434396472, 407620645, 512780976, 386756749, 765646984, 82540418, 531462382, 368632922, 49945499, 142976221, 816771711, 313523859, 651508710, 22075205, 792996001, 121496945, 282774548, 194988754, 824058003, 475907315, 456894153, 202670141, 757441620, 675083998, 253627920, 514309949, 721336389, 367837866, 683867007, 37004126, 316710427, 652750784, 628948827, 295172106, 470332979, 383051673, 30704195, 483844342, 725851121, 736392762, 610725144, 428351478, 614116793, 428887314, 120836983, 94306494, 47625988, 747810557, 847670250, 717853290, 415048225, 33527230, 182601707, 643310340, 569758741, 517968916, 37991572, 725901436, 121100746, 140217434, 196972023, 388470335, 750704489, 283782494, 335079558, 278768536, 270123596, 786040855, 489205610, 631729885, 840784696, 837153122, 510282236, 275593092, 550778837, 271296051, 29770948, 816759427, 667100020, 570033066, 524381860, 264355192, 593703527, 489874689, 815833524, 103256187, 426838378, 187707278, 131141838, 217334111, 245845721, 259280830, 195288427, 604582825, 549968147, 375351753, 635938707, 498850376, 359690065, 428849125, 568964151, 373179466, 315962451, 727270081, 552498538, 754673189, 699100371, 179406113, 765973080, 852396549, 764066263, 460795675, 498473885, 455689506, 778647714, 549718628, 440503714, 772464845, 14944659, 661054372, 193879673, 132558183, 77050370, 574982965, 327955070, 841542607, 828661586, 311194904, 607256460, 524105219, 694166094, 658857108, 694066517, 589766804, 305426500};

static const int32_t invnthroots[PARAM_N] = {4194304, 0, 799590749, 123163896, 571720440, 123096425, 363536617, 430069379, 97578304, 233798499, 146287160, 814356182, 323047149, 685860174, 426476045, 300023269, 327096616, 778581000, 519220275, 170642040, 507094660, 511144126, 721461359, 242018191, 83258711, 664233605, 463098399, 431420942, 355245941, 241451919, 680415756, 458270935, 554024510, 588726176, 787059838, 61505487, 810717150, 833152963, 146665260, 487783562, 91753754, 381722006, 626760999, 782816548, 552839592, 800711437, 246883684, 293251840, 684041509, 760649493, 553901795, 102737004, 492411753, 214394167, 342536509, 314107921, 291467932, 783686368, 117702665, 536801824, 692303314, 470448103, 36489310, 752202867, 431915603, 295154788, 168037079, 612229717, 125889740, 18462222, 364794673, 768921366, 744438427, 292350869, 126981190, 480366635, 435790036, 75110269, 473339543, 102965032, 732443182, 16215771, 839144646, 644825528, 17736002, 372858939, 400887641, 515996412, 19221563, 638870917, 210738670, 158763104, 114660965, 228667085, 488034364, 847366809, 622639932, 475846467, 13250039, 205203176, 372085585, 769655607, 385892190, 8072546, 138567408, 801999349, 405808088, 720664824, 108522159, 569847344, 799160831, 692608065, 414943364, 613023459, 786654890, 50802960, 260467066, 202702687, 734046905, 603459342, 839700468, 308394871, 722311451, 699777403, 22374319, 550670545, 322688429, 184634055, 84492855, 74887207, 657677887, 750719235, 743186743, 117509588, 281423643, 30536893, 595713176, 359645526, 521393356, 54392492, 251660853, 587390139, 583403747, 136141080, 536653503, 527777521, 27869747, 133535426, 359893566, 317235965, 65866368, 541892857, 59773397, 208691295, 458648156, 410913667, 446523188, 583655500, 227991730, 368462703, 305914073, 655196893, 231139719, 110724574, 519373224, 713416252, 25972826, 592322511, 793340967, 386517160, 229654537, 498795397, 405713855, 728007177, 596832214, 641203917, 70811091, 675082460, 142210822, 462318231, 771060553, 391703628, 559453583, 287758135, 296880137, 386974288, 730292733, 257474568, 832787810, 151318372, 240965764, 670436504, 549268685, 832585635, 556067362, 150115817, 499322629, 30478620, 414511040, 286625, 804208547, 258483477, 511046210, 529538873, 495737666, 501346379, 134881896, 77646365, 560425431, 357246722, 705884029, 119517052, 687185930, 756862923, 735617877, 647800035, 709887190, 688211604, 768331394, 737299285, 430534432, 449848206, 341777008, 277134279, 667923751, 468955149, 290192247, 139941889, 606494554, 784333752, 786261729, 600743738, 497369592, 476872946, 63922589, 307402052, 830759393, 780638771, 241715231, 159110858, 112963315, 760931357, 613969310, 558658124, 488825920, 359031231, 364606218, 671211166, 105954777, 46961466, 493857517, 96048886, 435777881, 294385359, 317029778, 185498339, 194348333, 631988788, 676565946, 76177123, 235536284, 724101241, 838426940, 328441846, 502444891, 834232734, 482643093, 773189303, 37754417, 532493208, 230411934, 116117628, 183424826, 420701762, 320540608, 534878501, 707398659, 279428210, 630524000, 693095228, 444432846, 798533604, 344160060, 695510745, 592030741, 610451502, 641254505, 200410701, 693069260, 814928379, 61263116, 14772992, 299201593, 315151061, 615198161, 609589643, 298710622, 601348541, 789166273, 590720490, 25875538, 773803371, 765980657, 129211513, 38407874, 778041982, 391754081, 530658484, 243963646, 202341277, 227499306, 93818814, 486710530, 340431073, 853680683, 461598772, 324147218, 485397703, 145993400, 302160261, 584243527, 72559837, 631732752, 543958345, 372348214, 507898934, 773490836, 84908725, 828632415, 421071530, 574407984, 516071391, 290036810, 556992433, 598724991, 609482473, 622350284, 179036971, 615596716, 418332827, 22136589, 480832292, 626362757, 335310210, 3381571, 510552266, 203821601, 676733886, 834017608, 71868693, 707708326, 87936370, 82831831, 241841139, 402746972, 692493113, 737486160, 537499751, 267367810, 699551299, 493807659, 813424051, 699173058, 148100634, 269380312, 474659621, 66780867, 146394645, 460948632, 59488192, 813486511, 344589655, 185100968, 332102331, 447384269, 433970139, 551118531, 216602585, 462146528, 343833579, 152958690, 228629740, 839334612, 766460853, 627467728, 503217672, 464666433, 316766024, 153300634, 9374851, 91546483, 485373350, 614501816, 60522579, 640783541, 765089386, 740443273, 403651982, 566927576, 455175044, 421000682, 383869612, 634563998, 544423053, 84168772, 45813128, 282174799, 854375497, 378601705, 681291503, 16668437, 598642135, 495442609, 767805439, 224742009, 145226127, 339056788, 245997702, 156406538, 502152782, 639789715, 619627174, 194425554, 743505616, 393360113, 111493601, 811141457, 67864427, 635815557, 161952260, 152036541, 687189284, 173823101, 481330704, 435910426, 77479757, 45671605, 165967377, 508987364, 454650228, 285237698, 823762478, 155476820, 39904415, 89494559, 609052994, 2142944, 384405591, 578520290, 314653482, 261809863, 724108705, 400765533, 3750804, 464455343, 455141753, 496120953, 705094579, 312721946, 637707278, 773267544, 610757008, 517624486, 395666302, 319889133, 504390520, 222889331, 670115720, 538832809, 24252463, 196246734, 190731435, 649496844, 48088429, 175519253, 812805302, 638724025, 217472038, 411668573, 805681154, 244278277, 454748254, 500104412, 46838353, 840286801, 381202125, 42356196, 808437026, 77880309, 90868990, 739789847, 17260372, 644638518, 27416441, 769174532, 334726705, 94401854, 95352305, 596067141, 231836345, 545401074, 529517520, 513407782, 412689007, 733000242, 628251117, 2259377, 308720824, 756326953, 660826534, 804822607, 237858126, 835514088, 717191565, 702644535, 293436916, 486187401, 341656977, 482517507, 766750587, 315279126, 468212458, 614928823, 523700620, 695374392, 165915576, 68188019, 481312426, 685635739, 449310723, 325379903, 737082933, 460017284, 165622684, 94804424, 326935560, 67100352, 705468653, 774515583, 724076485, 427573509, 652484584, 203872845, 436613147, 312945469, 848804064, 658980276, 617609071, 771530967, 339032631, 457429329, 182541610, 497540836, 773211316, 9596349, 736163055, 347677158, 712874284, 83922465, 651965290, 596982164, 486168950, 47622424, 625516667, 737561039, 58287239, 836072549, 815705916, 304650710, 455967856, 230968258, 646960355, 718599840, 151894398, 548962306, 652686773, 699567159, 131348837, 266952795, 818329069, 104086458, 431138434, 690897699, 837536709, 104377472, 129890839, 106968739, 540449464, 598343129, 756756074, 182213938, 135383263, 503924898, 37465284, 664897548, 560613634, 685850236, 634123755, 511634517, 100110574, 496459990, 480193259, 386247557, 509029848, 150792381, 627426938, 732515183, 702104400, 239522599, 719066663, 122332491, 338476215, 756182335, 499928569, 162713640, 491110265, 480658257, 44306878, 397946137, 850660333, 158218402, 690145178, 821722413, 127088630, 670534450, 627112467, 3474591, 80244737, 627840113, 786694439, 292645683, 756503412, 160635138, 363974449, 252297651, 156164905, 488344538, 601366383, 704355914, 623410546, 655849528, 589246646, 283646316, 146885370, 192603772, 63947227, 467651981, 106940414, 389784200, 7482333, 448201411, 46366545, 849697408, 479609121, 249371183, 461659786, 335158779, 340407134, 815338780, 72556383, 506887754, 178863311, 485532130, 784323879, 803880612, 739396534, 795281554, 2901913, 58407458, 621843337, 440189987, 255589771, 77185464, 577143201, 770912900, 139200731, 417736, 492229753, 443661937, 130337876, 184505034, 208122157, 558182025, 755697531, 717053099, 87053021, 757440929, 613108318, 37865696, 511504996, 141645902, 840343539, 585800098, 665239474, 447701518, 283875890, 690907523, 747259596, 418363900, 328981296, 207961688, 487396804, 246056084, 56680107, 555641969, 454257683, 558858622, 310095359, 97163483, 12117421, 763791192, 541919691, 814922574, 518009163, 800091855, 378732448, 176797787, 157597660, 166546372, 670200018, 482233421, 647623596, 731609459, 387604740, 298827498, 279262471, 476401495, 781768825, 315414053, 204700034, 145060371, 698390439, 773065719, 98408111, 149493052, 158228608, 36542720, 551500705, 483889404, 348007431, 579624807, 537778176, 637061769, 152969963, 808168685, 204154187, 33647322, 119198436, 100067024, 252345138, 89661559, 326706852, 426239227, 593402692, 821314275, 389804877, 808355973, 836610802, 294686257, 833670650, 76507528, 212976066, 227822748, 761966984, 767274714, 67908188, 287799, 716355757, 79653051, 320944123, 248612727, 342297066, 462159606, 88836892, 706700300, 819445633, 660472235, 1298807, 705948219, 418880616, 619839987, 619111449, 1840545, 68216923, 159484521, 719657042, 274973740, 475388471, 852192051, 609859768, 459082387, 849470264, 161983907, 45438631, 449392611, 188149071, 543737384, 480014356, 304593607, 637493557, 776618868, 307826410, 794545376, 474757759, 225026747, 188811164, 243790890, 353422446, 18456566, 498451335, 251787647, 353146499, 584294248, 771539680, 371662649, 648087919, 629957225, 700273919, 800021588, 196311788, 308573094, 251234312, 608555321, 246749372, 594126270, 712259077, 553639499, 317635127, 610378651, 124719525, 267238065, 8559114, 575724014, 486185240, 12865614, 771121479, 257785443, 95452228, 567572264, 9153027, 766136429, 600571552, 426426241, 409191721, 281640608, 287046049, 114310914, 820842639, 310228011, 814308407, 320091103, 73180544, 609575666, 715315000, 269942466, 127087206, 653564295, 164575803, 24346796, 852533444, 425706027, 432988782, 275625878, 235221340, 770505286, 440023593, 78298623, 428744240, 303501698, 621358435, 130078398, 769248530, 816260223, 193391598, 50761760, 276442394, 151388717, 488809164, 731742155, 348644696, 429517488, 306451971, 149120399, 519374807, 324073076, 510233888, 506944921, 206310032, 503153222, 643597114, 654880012, 540218873, 300259251, 318166009, 203108571, 665881362, 360747628, 38284878, 138782621, 356147042, 483377000, 562449728, 301384509, 368867547, 309572213, 6448285, 395251025, 94927820, 795377458, 492214210, 107407072, 586191294, 557442183, 531010043, 379912969, 72746429, 341695792, 160845069, 752377645, 545263241, 347384097, 507495314, 806212358, 119340082, 121418471, 329666961, 737648255, 196850985, 306292887, 254670411, 595949914, 356247153, 305635430, 792092259, 252775753, 779190777, 576261494, 96160933, 849059056, 761502120, 424645669, 525724791, 461953083, 808158154, 542376523, 724339657, 377382426, 833866355, 674707616, 369855717, 143195511, 190148698, 85170244, 849929007, 399463269, 82196789, 725239734, 477062704, 553231577, 154071445, 390775739, 242771863, 403819463, 288682216, 288292520, 521818527, 411796319, 228931791, 626038302, 161218270, 211741822, 388632026, 40320079, 360941977, 844142465, 662400481, 674042431, 679731944, 75905228, 553847861, 513258822, 269582582, 560976844, 44915445, 96058803, 357366078, 147825495, 219266508, 745492944, 338682892, 806242305, 711335109, 822440892, 487493458, 126496431, 839780871, 202920019, 638214653, 343420912, 387631379, 619529198, 321176184, 354612444, 296876226, 719675586, 769987246, 374380047, 768199123, 209440198, 16698328, 624388184, 170566786, 691048254, 13719023, 713636114, 290317042, 729346297, 623640602, 149346941, 472091512, 143725672, 548003544, 106597574, 582635892, 67211211, 67211211, 372079416, 228326808, 669524627, 794436297, 352215904, 409616434, 111500341, 370227471, 469810974, 345543335, 41097895, 447170994, 472699079, 831050773, 88438126, 648148126, 212047479, 849511452, 781326794, 654415097, 181813142, 533945221, 359149409, 314620478, 303583660, 125862256, 474393748, 542086007, 449100714, 40346585, 391555895, 803490126, 344104647, 382876867, 113574864, 35003723, 13218615, 534011414, 287471091, 367951227, 689398937, 330848600, 117169523, 842267169, 408610488, 105840133, 817941219, 654322415, 258966494, 979295, 570238048, 666180567, 39502511, 12659320, 90888029, 741764138, 13859473, 44697400, 296143459, 354395986, 4626343, 311536381, 612284694, 469336978, 236390821, 414955890, 797872101, 702400349, 746671810, 133329869, 615793897, 626820869, 854118416, 802810284, 539076284, 479508299, 169943685, 284727816, 273653127, 833830062, 124960751, 219421876, 520106753, 336200820, 144028141, 834680106, 329383902, 777445595, 579879444, 2337674, 232514215, 354057064, 278135720, 550414150, 645135339, 474876448, 399133403, 729926174, 247032859, 820505720, 462273792, 554325987, 253405914, 405891123, 792139433, 332379728, 678549136, 41043286, 95917648, 321982906, 721094608, 431121028, 647940555, 782072302, 477897324, 317267599, 150081183, 621357568, 275847079, 812121123, 543575623, 459825267, 645757992, 172397403, 699018412, 684665584, 839369925, 732019092, 666019773, 153868765, 288460812, 352015226, 738981352, 449645856, 398634664, 370928768, 165860782, 579876029, 135458859, 373162768, 437771295, 411715677, 379974178, 137403176, 61618771, 156497034, 276415444, 562485472, 821852582, 731890595, 6406474, 762272297, 495015660, 272198983, 403478790, 372358261, 397261152, 405405484, 111140304, 428951814, 281770837, 709165644, 751038044, 185122019, 350382831, 281631104, 327585110, 355517384, 560235996, 765286269, 553115545, 343773200, 213197061, 528252933, 630750794, 250420502, 828532210, 472230055, 258302993, 1071768, 727271351, 675607114, 664852383, 204092040, 713650897, 330541411, 268354475, 149908755, 802810442, 59329157, 703579777, 585232074, 52254659, 695557491, 727384025, 842481129, 218611430, 481582399, 666681186, 740184375, 210375736, 718086050, 217233511, 748696797, 112413425, 588442315, 410119504, 45995657, 833895351, 613118361, 320534896, 272765281, 337756701, 208990528, 518090077, 137054100, 43714105, 210422927, 212495367, 583071419, 671799841, 368467642, 150789600, 716337979, 387254927, 401726810, 39753954, 70597741, 71908437, 833340986, 409872429, 792681318, 358968770, 34810494, 468251896, 203371076, 426080472, 718750287, 734803248, 190882172, 798120983, 185962539, 831860724, 420536236, 143156329, 510908796, 612725135, 415003285, 180240121, 459393251, 650349261, 384100748, 514051630, 586529501, 42624813, 474150117, 641399041, 800808377, 21529545, 709238534, 508879063, 205922493, 340013418, 317194182, 605568048, 55049999, 808812550, 221429222, 721028875, 39001205, 490388581, 48846926, 432969831, 803907673, 24323661, 375104304, 848856365, 436089319, 104598780, 534211365, 766898613, 121308468, 810472692, 560611802, 811832200, 151270334, 579467437, 665696400, 444639980, 788399778, 575989880, 538535277, 7231453, 102667230, 790464771, 184759016, 598918155, 157307947, 305166485, 854049152, 355231843, 578963122, 788608272, 453831356, 553260416, 214210042, 56378160, 749595842, 587425629, 527708988, 473877765, 620443984, 205001511, 176116250, 395769668, 611496389, 780991648, 304041960, 354587855, 304923784, 635520217, 113927794, 315898167, 354183382, 32095951, 785967584, 61304623, 769678502, 137699170, 20069643, 15658817, 242832002, 6594023, 632480383, 738614023, 606406717, 286463084, 100550117, 364564328, 723389818, 782682920, 25758060, 236674390, 454748731, 39100988, 378135148, 306498566, 222936580, 127745042, 375117294, 547567836, 79757173, 49398880, 847979620, 627667366, 526689333, 120166696, 314002185, 599364639, 367860198, 810758172, 291927885, 234602214, 495952225, 445935829, 137359813, 759979959, 125945576, 782418281, 801031981, 100588642, 94994511, 169392351, 541934121, 213010036, 790614856, 89842384, 38725345, 268946806, 71208034, 639011863, 66050763, 124714421, 349124759, 652213434, 722931858, 592295814, 54068470, 189443989, 474429480, 532580021, 927438, 208088554, 616152547, 447387911, 631891149, 691029114, 778116138, 609835018, 168615315, 817003795, 378975942, 615510489, 352783594, 815201836, 376677038, 551947695, 461944598, 430115272, 250334003, 26580832, 787966631, 640469042, 317880607, 394012607, 47127947, 382984844, 705209791, 479652101, 283366674, 480367179, 437186940, 569206742, 833612894, 85295237, 483719308, 535956840, 57169973, 222707295, 457267631, 686472512, 26503302, 399279858, 716437439, 529150893, 152988478, 500189672, 478769042, 684270669, 313540487, 844265634, 240816178, 661398144, 761465714, 340209055, 558736367, 479486594, 614370151, 507779521, 594720105, 653566975, 214191654, 619758115, 612526297, 742732061, 684497513, 457189940, 336458502, 495091236, 694934248, 790654998, 153481462, 551626775, 853776923, 157611966, 730258200, 207991393, 414392009, 267261090, 335890460, 578278766, 723156430, 797408885, 724537760, 104594946, 578375970, 473212039, 354989749, 766440906, 270597731, 39522184, 727418928, 451076025, 257422373, 428257443, 257020840, 737112002, 5778940, 235233388, 266316511, 448874126, 746885985, 258321672, 697962543, 135835735, 666267784, 317876859, 361218800, 611114607, 142776104, 539484851, 426955609, 56039177, 674753905, 519872924, 405510875, 510482542, 526258730, 160384521, 700302963, 730334696, 495244927, 79195805, 462561883, 477178043, 31838340, 337560808, 320680840, 153155010, 435690512, 395086417, 731069869, 106347084, 100953651, 27685053, 466563009, 366117839, 632957194, 226741766, 681692197, 344068906, 647229284, 184770289, 695508960, 786964921, 430220603, 229976804, 601976002, 593631263, 157667191, 64416368, 667271938, 103258799, 853507927, 448718197, 324622669, 807031302, 111033886, 363095290, 733008132, 584599927, 215106718, 204595448, 789391202, 156763646, 394894137, 15318276, 724226613, 50370855, 853521046, 300609851, 195787020, 35559018, 716356341, 299686313, 102995710, 619302207, 73892759, 436275013, 91644021, 265908044, 639916126, 696560634, 466423179, 296705777, 769200785, 192975555, 670902726, 142110942, 150143768, 825131019, 46418522, 154667810, 293331244, 542899294, 433907635, 381222231, 6352190, 787491924, 120560998, 35555489, 741792089, 452765648, 239767683, 383569806, 492743517, 410585094, 585843987, 551288771, 274717998, 359549605, 219054017, 82990558, 177948249, 112668085, 834343834, 143026641, 82980271, 213853051, 89093784, 127904503, 373662635, 647275164, 88651034, 602289635, 424976300, 198244326, 75096141, 624927005, 355004771, 805731799, 322753953, 459797292, 701721210, 500736135, 580987125, 195036983, 259731921, 583007438, 428610601, 45393463, 274974224, 1380742, 624330230, 329369859, 120313306, 685755128, 715674779, 507824796, 241819467, 654671926, 182422254, 781048187, 120153432, 221436191, 572766839, 723482896, 161142741, 855329838, 309205569, 132263372, 230888645, 655341036, 159349908, 538072615, 512044522, 837131225, 695901226, 388657367, 259135857, 80676781, 146735509, 216221604, 604410079, 285151301, 779752185, 504976096, 521744722, 304257771, 684712294, 778434400, 293484485, 207736038, 532587045, 401599663, 557019174, 647296249, 224084270, 362604228, 547857767, 442925671, 639506811, 178192846, 830255672, 107310174, 520739845, 672757189, 342472248, 679199279, 192514858, 240267767, 318932501, 105291081, 622939246, 354450163, 783483622, 327017213, 740626597, 259795820, 262470414, 179070139, 408030351, 363158627, 673091237, 121570146, 410325224, 128367468, 235460707, 116466445, 778527632, 499005127, 372763161, 616288346, 257753235, 679009882, 351380725, 647272294, 501534653, 667774533, 279144965, 206652748, 344170208, 789874223, 263191257, 768394027, 219144843, 827565545, 312202549, 329697619, 217289168, 534302105, 410963756, 243513307, 658682520, 839884386, 349346273, 161989692, 852239525, 213666435, 264860916, 417529013, 177582310, 280832681, 490479077, 670275745, 809308415, 247398431, 305186932, 532839235, 348394294, 305425902, 512002483, 515012813, 735699579, 134967921, 427313602, 748690748, 191060341, 567011460, 770589420, 735941867, 227631048, 577326845, 16068420, 369535453, 163010147, 468934783, 3548791, 691707879, 637101181, 147904704, 294147580, 623012628, 86152259, 660054566, 733203829, 187919043, 847431900, 453863136, 856070687, 682066780, 719072606, 339945400, 192105054, 117729970, 397289184, 666174993, 352679060, 576182796, 472011897, 760711857, 150235833, 33077426, 563437323, 52218518, 372047259, 296226937, 676258824, 405468326, 397505041, 402125077, 111215778, 719823476, 77683316, 603992248, 371406302, 521340733, 317433424, 285296261, 425782418, 225526881, 508018181, 217530530, 447575012, 5632317, 159599217, 539628400, 375275257, 830598115, 499155975, 274677461, 139497154, 385378454, 139864650, 654478900, 329522218, 763919549, 27894360, 581100823, 394319408, 371954478, 815750641, 428041704, 98008216, 83041480, 693509979, 104732304, 110738272, 230089019, 46261539, 574873878, 392117878, 673837241, 786627705, 459340800, 325920507, 189024572, 465911405, 87720869, 460286679, 724239679, 240514257, 102771024, 364818927, 625118805, 779235777, 853280591, 31056210, 408467697, 11762864, 134628374, 569023857, 328933761, 16567897, 703717380, 672540694, 719508608, 178343685, 21431160, 109717027, 167504382, 706076630, 538933187, 709032510, 270810626, 417684712, 587848810, 390306236, 727536571, 372045492, 700724148, 315064294, 636190645, 727616800, 662221650, 28722308, 546026846, 117855551, 744981873, 767855133, 306959533, 231986920, 416877034, 331640296, 396297558, 371476797, 149017033, 837794816, 125935353, 440074167, 132941506, 305324132, 170195812, 424146810, 405549874, 73582983, 174821766, 774340522, 635062361, 447409103, 53540750, 210652387, 249347191, 657812622, 141011385, 102560114, 395214648, 645575568, 254756598, 195458074, 13617981, 215417819, 291885383, 304630622, 377829034, 792458977, 133781547, 391104595, 718869463, 348000005, 93790310, 185731557, 110483207, 417476257, 143274515, 852129974, 362018480, 642974586, 110484105, 713112291, 701728315, 788345367, 226604144, 702855397, 524704667, 734707029, 338346749, 650051689, 627501274, 625119197, 439262644, 826164778, 206938503, 200067608, 108384972, 17975371, 428210459, 589056818, 41699002, 391403901, 769815361, 105829243, 445123786, 399308710, 795772563, 1346735, 162038639, 148953462, 360517637, 207427266, 468961749, 41968903, 766827247, 470210285, 652784008, 324111414, 756153001, 660078920, 263875897, 631805572, 508480129, 537156894, 362457310, 798777991, 153934666, 667602490, 157655355, 483122740, 640617576, 172122076, 714230546, 125800565, 115826890, 539800191, 722860449, 501597806, 217708491, 700033132, 151419186, 779943777, 123459872, 324073446, 824671664, 205198030, 612467530, 426743668, 507085872, 525938500, 552395936, 545764056, 288114333, 516523590, 346696493, 136012300, 37500275, 223278794, 631235540, 521120749, 813498767, 601579627, 647707563, 20107761};

static int32_t gj[512] = {14237691, 147314272, 762289503, 284789571, 461457674, 723990704, 123382358, 685457283, 458774590, 644795450, 723622678, 441493948, 676062368, 648739792, 214990524, 261899220, 138474554, 205277234, 788000393, 541334956, 769530525, 786231394, 812002793, 251385069, 152717354, 674883688, 458756880, 323745289, 823881240, 686340396, 716163820, 107735873, 144028791, 586327243, 71257244, 739303131, 487030542, 313626215, 396596783, 664640087, 728258996, 854656117, 567834989, 2315110, 210792230, 795895843, 433034260, 432732757, 480454055, 750130006, 47628047, 2271301, 98590211, 729637734, 683553815, 476917424, 121851414, 296210757, 820475433, 403416438, 605633242, 804828963, 435181077, 781182803, 276684653, 329135201, 697859430, 248472020, 396579594, 109340098, 97605675, 755271019, 565755143, 534799496, 378374148, 85686225, 298978496, 650100484, 712463562, 818417023, 283716467, 269132585, 153024538, 223768950, 331863760, 761523727, 586019306, 805044248, 810909760, 77905343, 401203343, 162625701, 616243024, 659789238, 385270982, 720521140, 545633566, 688663167, 740046782, 257189758, 115795491, 101106443, 409863172, 622399622, 405606434, 498832246, 730567206, 350755879, 41236295, 561547732, 525723591, 18655497, 3396399, 289694332, 221478904, 738940554, 769726362, 32128402, 693016435, 275431006, 65292213, 601823865, 469363520, 480544944, 607230206, 473150754, 267072604, 463615065, 412972775, 197544577, 770873783, 189036815, 407973558, 110878446, 442760341, 667560342, 756992079, 663708407, 585601880, 763637579, 660019224, 424935088, 249313490, 844593983, 664952705, 274981537, 40233161, 655530034, 742724096, 8926394, 67709207, 616610795, 539664358, 306118645, 741629065, 283521858, 621397947, 369041534, 162477412, 258256937, 269480966, 75469364, 815614830, 724060729, 510819743, 489239410, 265607303, 103024793, 434961090, 474838542, 234701483, 505818866, 450427360, 188113529, 650423376, 599263141, 720479782, 755079140, 469798456, 745591660, 432033717, 530128582, 94480771, 722477467, 169342233, 35413255, 89769525, 424389771, 240236288, 360665614, 66702784, 76128663, 565345206, 605031892, 393503210, 249841967, 485930917, 45880284, 746120091, 684031522, 537926896, 408749937, 608644803, 692593939, 515424474, 748771159, 155377700, 347101257, 393516280, 708186062, 809233270, 562547654, 768251664, 651110951, 574473323, 588028067, 352359235, 646902518, 410726541, 134129459, 460099853, 829152883, 819102028, 7270760, 562515302, 419641762, 347973450, 161011009, 401974733, 619807719, 559105457, 276126568, 165473862, 380215069, 356617900, 347744328, 615885981, 824819772, 811367929, 6451967, 515345658, 648239021, 56427040, 709160497, 71545092, 390921213, 17177139, 194174898, 825533429, 497469884, 88988508, 64227614, 641021859, 159258883, 529265733, 823190295, 567280997, 414094239, 238392498, 695610059, 416342151, 90807038, 206865379, 568337348, 168011486, 844375038, 777332780, 147582038, 199025846, 396231915, 151630666, 466807217, 12672521, 570774644, 764098787, 283719496, 779154504, 383628791, 851035387, 395488461, 291115871, 52707730, 776449280, 479801706, 73403989, 402014636, 255214342, 56904698, 446531030, 639487570, 848061696, 202732901, 739018922, 653983847, 453022791, 391722680, 584290855, 270911670, 390838431, 653070075, 535876472, 83207555, 131151682, 505677504, 778583044, 472363568, 734419459, 768500943, 321131696, 371745445, 751887879, 51797676, 157604159, 838805925, 358099697, 763440819, 776721566, 719570904, 304610785, 656838485, 239522278, 796234199, 659506535, 825373307, 674901303, 250484891, 54612517, 410236408, 111976920, 728940855, 720463104, 559960962, 514189554, 637176165, 436151981, 485801800, 802811374, 549456481, 808832355, 112672706, 199163132, 807410080, 645955491, 365378122, 222316474, 381896744, 693909930, 402130292, 199856804, 277639257, 6848838, 648262319, 601521139, 108516632, 392382841, 563420106, 475932203, 249861415, 99274558, 152886431, 744977783, 269184267, 562674804, 760959275, 733098096, 771348891, 674288361, 631521272, 513632066, 476339117, 621937967, 206834230, 507101607, 420341698, 528715580, 853092790, 580174958, 278044321, 432350205, 603769437, 144426940, 733518338, 365468467, 848983278, 385382826, 846062026, 593903051, 216589699, 219997638, 350708517, 733669279, 624754239, 499821820, 772548008, 199677439, 287505007, 144199205, 215073292, 825467700, 101591831, 571728784, 841898341, 420897808, 61323616, 823475752, 72494861, 89946011, 236594097, 379582577, 539401967, 221244669, 479250487, 100726882, 263096036, 647161225, 491060387, 419890898, 816149055, 546441322, 690509770, 215789647, 5870948, 821456387, 294091098, 783700004, 278643020, 520754327, 813718894, 123610053, 157045201, 265331664, 807174256, 258134244, 703519669, 300265991, 41892125, 662173055, 439638698, 494124024, 700655120, 535348417, 37146186, 379568907, 644973451, 554904963, 594757858, 477812802, 266085643, 46337543, 454847754, 496027901, 701947604, 5722633, 790588605, 233501932, 728956461, 462020148, 214013660, 155806979, 159935426, 423504958, 638889309, 602641304, 277759403, 71654804, 710920410, 108337831, 641924564, 252946326, 463082282, 23277660, 142056200, 263317553, 9044238, 367816044, 349695658, 291597086, 230031083, 385106216, 281069679, 644033142, 134221740, 212497862, 686686078, 787489098, 781698667, 748299513, 774414792, 380836293, 114027649, 766161763, 10536612, 707355910, 100516219, 637517297, 21478533, 769067854, 668364559, 410803198, 64949715, 643421522, 525590993, 585289785, 423839840, 554109325, 450599860, 295350132, 435789550, 306634115, 611298620, 777817576, 553655202};

static int32_t invgj[512] = {14237691, 708831649, 571356350, 93856418, 170688638, 732763563, 132155217, 394688247, 594246701, 641155397, 207406129, 180083553, 414651973, 132523243, 211350471, 397371331, 748410048, 139982101, 169805525, 32264681, 532400632, 397389041, 181262233, 703428567, 604760852, 44143128, 69914527, 86615396, 314810965, 68145528, 650868687, 717671367, 74963118, 420964844, 51316958, 250512679, 452729483, 35670488, 559935164, 734294507, 379228497, 172592106, 126508187, 757555710, 853874620, 808517874, 106015915, 375691866, 423413164, 423111661, 60250078, 645353691, 853830811, 288310932, 1489804, 127886925, 191505834, 459549138, 542519706, 369115379, 116842790, 784888677, 269818678, 712117130, 392530856, 589073317, 382995167, 248915715, 375600977, 386782401, 254322056, 790853708, 580714915, 163129486, 824017519, 86419559, 117205367, 634667017, 566451589, 852749522, 837490424, 330422330, 294598189, 814909626, 505390042, 125578715, 357313675, 450539487, 233746299, 446282749, 755039478, 740350430, 598956163, 116099139, 167482754, 310512355, 135624781, 470874939, 196356683, 239902897, 693520220, 454942578, 778240578, 45236161, 51101673, 270126615, 94622194, 524282161, 632376971, 703121383, 587013336, 572429454, 37728898, 143682359, 206045437, 557167425, 770459696, 477771773, 321346425, 290390778, 100874902, 758540246, 746805823, 459566327, 607673901, 158286491, 527010720, 579461268, 32955626, 326880188, 696887038, 215124062, 791918307, 767157413, 358676037, 30612492, 661971023, 838968782, 465224708, 784600829, 146985424, 799718881, 207906900, 340800263, 849693954, 44777992, 31326149, 240259940, 508401593, 499528021, 475930852, 690672059, 580019353, 297040464, 236338202, 454171188, 695134912, 508172471, 436504159, 293630619, 848875161, 37043893, 26993038, 396046068, 722016462, 445419380, 209243403, 503786686, 268117854, 281672598, 205034970, 87894257, 293598267, 46912651, 147959859, 462629641, 509044664, 700768221, 107374762, 340721447, 163551982, 247501118, 447395984, 318219025, 172114399, 110025830, 810265637, 370215004, 606303954, 462642711, 251114029, 290800715, 780017258, 789443137, 495480307, 615909633, 431756150, 766376396, 820732666, 686803688, 133668454, 761665150, 326017339, 424112204, 110554261, 386347465, 101066781, 135666139, 256882780, 205722545, 668032392, 405718561, 350327055, 621444438, 381307379, 421184831, 753121128, 590538618, 366906511, 345326178, 132085192, 40531091, 780676557, 586664955, 597888984, 693668509, 487104387, 234747974, 572624063, 114516856, 550027276, 316481563, 239535126, 788436714, 847219527, 113421825, 200615887, 815912760, 581164384, 191193216, 11551938, 606832431, 431210833, 196126697, 92508342, 270544041, 192437514, 99153842, 188585579, 413385580, 745267475, 448172363, 667109106, 85272138, 658601344, 443173146, 302490719, 78328345, 244847301, 549511806, 420356371, 560795789, 405546061, 302036596, 432306081, 270856136, 330554928, 212724399, 791196206, 445342723, 187781362, 87078067, 834667388, 218628624, 755629702, 148790011, 845609309, 89984158, 742118272, 475309628, 81731129, 107846408, 74447254, 68656823, 169459843, 643648059, 721924181, 212112779, 575076242, 471039705, 626114838, 564548835, 506450263, 488329877, 847101683, 592828368, 714089721, 832868261, 393063639, 603199595, 214221357, 747808090, 145225511, 784491117, 578386518, 253504617, 217256612, 432640963, 696210495, 700338942, 642132261, 394125773, 127189460, 622643989, 65557316, 850423288, 154198317, 360118020, 401298167, 809808378, 590060278, 378333119, 261388063, 301240958, 211172470, 476577014, 818999735, 320797504, 155490801, 362021897, 416507223, 193972866, 814253796, 555879930, 152626252, 598011677, 48971665, 590814257, 699100720, 732535868, 42427027, 335391594, 577502901, 72445917, 562054823, 34689534, 850274973, 640356274, 165636151, 309704599, 39996866, 436255023, 365085534, 208984696, 593049885, 755419039, 376895434, 634901252, 316743954, 476563344, 619551824, 766199910, 783651060, 32670169, 794822305, 435248113, 14247580, 284417137, 754554090, 30678221, 641072629, 711946716, 568640914, 656468482, 83597913, 356324101, 231391682, 122476642, 505437404, 636148283, 639556222, 262242870, 10083895, 470763095, 7162643, 490677454, 122627583, 711718981, 252376484, 423795716, 578101600, 275970963, 3053131, 327430341, 435804223, 349044314, 649311691, 234207954, 379806804, 342513855, 224624649, 181857560, 84797030, 123047825, 95186646, 293471117, 586961654, 111168138, 703259490, 756871363, 606284506, 380213718, 292725815, 463763080, 747629289, 254624782, 207883602, 849297083, 578506664, 656289117, 454015629, 162235991, 474249177, 633829447, 490767799, 210190430, 48735841, 656982789, 743473215, 47313566, 306689440, 53334547, 370344121, 419993940, 218969756, 341956367, 296184959, 135682817, 127205066, 744169001, 445909513, 801533404, 605661030, 181244618, 30772614, 196639386, 59911722, 616623643, 199307436, 551535136, 136575017, 79424355, 92705102, 498046224, 17339996, 698541762, 804348245, 104258042, 484400476, 535014225, 87644978, 121726462, 383782353, 77562877, 350468417, 724994239, 772938366, 320269449, 203075846, 465307490, 585234251, 271855066, 464423241, 403123130, 202162074, 117126999, 653413020, 8084225, 216658351, 409614891, 799241223, 600931579, 454131285, 782741932, 376344215, 79696641, 803438191, 565030050, 460657460, 5110534, 472517130, 76991417, 572426425, 92047134, 285371277, 843473400, 389338704, 704515255, 459914006, 657120075, 708563883, 78813141, 11770883, 688134435, 287808573, 649280542, 765338883, 439803770, 160535862, 617753423, 442051682, 288864924};


void poly_uniform(poly_k a, const unsigned char *seed)         
{ // Generation of polynomials "a_i"
  unsigned int pos=0, i=0, nbytes = (PARAM_Q_LOG+7)/8;
  unsigned int nblocks=PARAM_GEN_A;
  uint32_t val1, val2, val3, val4, mask = (uint32_t)(1<<PARAM_Q_LOG)-1;
  unsigned char buf[SHAKE128_RATE*PARAM_GEN_A];
  uint16_t dmsp=0;

  cshake128_simple(buf, SHAKE128_RATE*PARAM_GEN_A, dmsp++, seed, CRYPTO_RANDOMBYTES);    
     
  while (i < PARAM_K*PARAM_N) {   
    if (pos > SHAKE128_RATE*nblocks - 4*nbytes) {
      nblocks = 1;
      cshake128_simple(buf, SHAKE128_RATE*nblocks, dmsp++, seed, CRYPTO_RANDOMBYTES);    
      pos = 0;
    } 
    val1  = (*(uint32_t*)(buf+pos)) & mask;
    pos += nbytes;
    val2  = (*(uint32_t*)(buf+pos)) & mask;
    pos += nbytes;
    val3  = (*(uint32_t*)(buf+pos)) & mask;
    pos += nbytes;
    val4  = (*(uint32_t*)(buf+pos)) & mask;
    pos += nbytes;
    if (val1 < PARAM_Q && i < PARAM_K*PARAM_N)
      a[i++] = reduce((int64_t)val1*PARAM_R2_INVN);
    if (val2 < PARAM_Q && i < PARAM_K*PARAM_N)
      a[i++] = reduce((int64_t)val2*PARAM_R2_INVN);
    if (val3 < PARAM_Q && i < PARAM_K*PARAM_N)
      a[i++] = reduce((int64_t)val3*PARAM_R2_INVN);
    if (val4 < PARAM_Q && i < PARAM_K*PARAM_N)
      a[i++] = reduce((int64_t)val4*PARAM_R2_INVN);
  }
}


int32_t reduce(int64_t a)
{ // Montgomery reduction
  int64_t u;

  u = (a*PARAM_QINV) & 0xFFFFFFFF;
  u *= PARAM_Q;
  a += u;
  return (int32_t)(a>>32);
}


int64_t barr_reduce64(int64_t a)
{ // Barrett reduction
  int64_t u = (a*PARAM_BARR_MULT)>>PARAM_BARR_DIV;
  return a - u*PARAM_Q;
}


sdigit_t barr_reduce(sdigit_t a)
{ // Barrett reduction
  digit_t u = ((int64_t)a*PARAM_BARR_MULT)>>PARAM_BARR_DIV;
  return a - (digit_t)u*PARAM_Q;
}


void dgt(poly x)
{
  int m, distance;
  int j1, j2, j, k;
  int32_t a, temp_re, temp_img;
  
  distance = 1024;
  for(m = 1; m < 1024; m <<= 1)
  {
    for(k = 0; k < m; ++k)
    {
      j1 = k*distance << 1;
      j2 = j1+distance-1;

      a = gj[k];
      for(j = j1; j <= j2; j = j+2)
      {
        temp_re = reduce((int64_t)a * x[j+distance]);
        temp_img = reduce((int64_t)a * x[j+distance+1]);

        x[j+distance] = barr_reduce64(x[j] - temp_re);
        x[j+distance+1] = barr_reduce64(x[j+1] - temp_img);
        
        x[j] = barr_reduce64(x[j] + temp_re);
        x[j+1] = barr_reduce64(x[j+1] + temp_img);
      }
    }
    distance >>= 1;
    m <<= 1;
    for(k = 0; k < m; ++k)
    {
      j1 = k*distance << 1;
      j2 = j1+distance-1;

      a = gj[k];
      for(j = j1; j <= j2; j = j+2)
      {
        temp_re = reduce((int64_t)a * x[j+distance]);
        temp_img = reduce((int64_t)a * x[j+distance+1]);

        x[j+distance] = x[j] - temp_re;
        x[j+distance] += (x[j+distance] >> (RADIX32-1)) & PARAM_Q;

        x[j+distance+1] = x[j+1] - temp_img;        
        x[j+distance+1] += (x[j+distance+1] >> (RADIX32-1)) & PARAM_Q;

        x[j] = x[j] + temp_re - PARAM_Q;
        x[j] += (x[j] >> (RADIX32-1)) & PARAM_Q;
        
        x[j+1] = x[j+1] + temp_img - PARAM_Q;
        x[j+1] += (x[j+1] >> (RADIX32-1)) & PARAM_Q;
      }
    }
    distance >>= 1;    
  }
}


void idgt(poly x) 
{
  int m, distance;
  int j1, j2, j, k;
  int32_t a, sub_re, sub_img;
  
  m = 512;
  for(distance = 2; distance < PARAM_N; distance <<= 1)
  {
    for(k = 0; k < m; ++k)
    {
      j1 = k*distance << 1;
      j2 = j1+distance-1;

      a = invgj[k];
      for(j = j1; j <= j2; j += 2)
      {
        sub_re = x[j] - x[j+distance];
        sub_img = x[j+1] - x[j+distance+1];
        
        x[j] = barr_reduce64(x[j] + x[j+distance]);        
        x[j+1] = barr_reduce64(x[j+1] + x[j+distance+1]);

        x[j+distance] = reduce((int64_t)a * sub_re);
        x[j+distance+1] = reduce((int64_t)a * sub_img);
      }
    }
    m >>= 1;
    distance <<= 1;
    for(k = 0; k < m; ++k)
    {
      j1 = k*distance << 1;
      j2 = j1+distance-1;

      a = invgj[k];
      for(j = j1; j <= j2; j += 2)
      {
        sub_re = x[j] - x[j+distance];
        sub_img = x[j+1] - x[j+distance+1];
        
        x[j] = x[j] + x[j+distance] - PARAM_Q;
        x[j+1] = x[j+1] + x[j+distance+1] - PARAM_Q;

        x[j+distance] = reduce((int64_t)a * sub_re);
        x[j+distance+1] = reduce((int64_t)a * sub_img);
      }
    }
    m >>= 1;
  }
}


static void poly_pointwise(poly result, const poly x, const poly y)
{ // Pointwise polynomial multiplication result = x.y

  for (int i=0; i<PARAM_N; i++)
    result[i] = reduce((int64_t)x[i]*y[i]);
}


void poly_dgt(poly x_dgt, const poly x)
{

  int i, j;

  j = 0;
  for(i = 0; i < PARAM_N; i += 2) {             
      x_dgt[i] = reduce(
      (int64_t)x[j] * nthroots[i] - 
      (int64_t)x[1024+j] * nthroots[i+1]
      );      
      x_dgt[i+1] = reduce(
      (int64_t)x[j] * nthroots[i+1] + 
      (int64_t)x[1024+j] * nthroots[i]
      );
      j++;
  } 

  dgt(x_dgt);
}


void poly_mul(poly result, const poly a, const poly b)
{
  
  poly mul;
  int i;

  for(i = 0; i < PARAM_N; i += 2) {             
    mul[i] = reduce(
      ((int64_t)a[i] * b[i]) - 
      ((int64_t)a[i+1] * b[i+1])
    );
    mul[i+1] = reduce(
      ((int64_t)a[i] * b[i+1]) + 
      ((int64_t)a[i+1] * b[i])
    ) - PARAM_Q;
  }

  /* Recovering the multiplication result in Z[x]/<x^n+1> */
  idgt(mul);

  /* Removing the twisting factors and writing the result from the Gaussian integer to the polynomial form */
  i = 0;
  for(int j = 0; j < 1024; ++j) {
      result[j] = reduce(
               (int64_t)mul[i] * invnthroots[i] -
               (int64_t)mul[i+1] * invnthroots[i+1]
               );

      result[j+1024] = reduce(
               (int64_t)mul[i] * invnthroots[i+1] + 
               (int64_t)mul[i+1] * invnthroots[i]
               );
      i += 2;
  }
}


void poly_add(poly result, const poly x, const poly y)
{ // Polynomial addition result = x+y

    for(int i=0; i<PARAM_N; i++)
      result[i] = x[i] + y[i];
}


void poly_add_correct(poly result, const poly x, const poly y)
{ // Polynomial addition result = x+y with correction

    for (int i=0; i<PARAM_N; i++) {
      result[i] = x[i] + y[i];
      result[i] += (result[i] >> (RADIX32-1)) & PARAM_Q;    // If result[i] < 0 then add q
      result[i] -= PARAM_Q;
      result[i] += (result[i] >> (RADIX32-1)) & PARAM_Q;    // If result[i] >= q then subtract q
    }
}


void poly_sub(poly result, const poly x, const poly y)
{ // Polynomial subtraction result = x-y

    for (int i=0; i<PARAM_N; i++)
      result[i] = x[i] - y[i];
}    


void poly_sub_reduce(poly result, const poly x, const poly y)
{ // Polynomial subtraction result = x-y

    for (int i=0; i<PARAM_N; i++)
      result[i] = (int32_t)barr_reduce(x[i] - y[i]);
}


/********************************************************************************************
* Name:        sparse_mul8
* Description: performs sparse polynomial multiplication
* Parameters:  inputs:
*              - const unsigned char* s: part of the secret key
*              - const uint32_t pos_list[PARAM_H]: list of indices of nonzero elements in c
*              - const int16_t sign_list[PARAM_H]: list of signs of nonzero elements in c
*              outputs:
*              - poly prod: product of 2 polynomials
*
* Note: pos_list[] and sign_list[] contain public information since c is public
*********************************************************************************************/
void sparse_mul8(poly prod, const unsigned char *s, const uint32_t pos_list[PARAM_H], const int16_t sign_list[PARAM_H])
{
  int i, j, pos;
  int8_t *t = (int8_t*)s;

  for (i=0; i<PARAM_N; i++)
    prod[i] = 0;

  for (i=0; i<PARAM_H; i++) {
    pos = pos_list[i];
    for (j=0; j<pos; j++) {
        prod[j] = prod[j] - sign_list[i]*t[j+PARAM_N-pos];
    }
    for (j=pos; j<PARAM_N; j++) {
        prod[j] = prod[j] + sign_list[i]*t[j-pos];
    }
  }
}


/********************************************************************************************
* Name:        sparse_mul32
* Description: performs sparse polynomial multiplication 
* Parameters:  inputs:
*              - const int32_t* pk: part of the public key
*              - const uint32_t pos_list[PARAM_H]: list of indices of nonzero elements in c
*              - const int16_t sign_list[PARAM_H]: list of signs of nonzero elements in c
*              outputs:
*              - poly prod: product of 2 polynomials
*********************************************************************************************/
void sparse_mul32(poly prod, const int32_t *pk, const uint32_t pos_list[PARAM_H], const int16_t sign_list[PARAM_H])
{
  int i, j, pos;
  int64_t temp[PARAM_N] = {0};
  
  for (i=0; i<PARAM_H; i++) {
    pos = pos_list[i];
    for (j=0; j<pos; j++) {
        temp[j] = temp[j] - sign_list[i]*pk[j+PARAM_N-pos];
    }
    for (j=pos; j<PARAM_N; j++) {
        temp[j] = temp[j] + sign_list[i]*pk[j-pos];
    }
  }
  for (i=0; i<PARAM_N; i++)
    prod[i] = (int32_t)barr_reduce64(temp[i]);
}