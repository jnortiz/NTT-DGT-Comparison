/*************************************************************************************
* qTESLA: an efficient post-quantum signature scheme based on the R-LWE problem
*
* Abstract: NTT, modular reduction and polynomial functions
**************************************************************************************/

#include "poly.h"
#include "sha3/fips202.h"
#include "api.h"

static const int32_t nthroots[PARAM_N] = {1, 0, 564596787, 669180230, 619577133, 681155418, 472013115, 398837054, 18144298, 561305131, 621706898, 621764587, 748115775, 450187933, 116584507, 480983820, 562246037, 855762601, 298810020, 187230386, 127930583, 795613843, 547517317, 771265406, 268114156, 92097450, 224777945, 314033009, 449271488, 631219645, 383633840, 455430511, 557610951, 60456506, 258921213, 625799471, 833211777, 41308909, 239856151, 76259286, 517191351, 75295202, 571177067, 561777030, 445011539, 676257329, 555221783, 155615709, 57231631, 646837333, 670949274, 453358349, 569592512, 41329400, 83013864, 842874363, 656667408, 467794476, 204618922, 447404017, 794728205, 691478893, 801596459, 405650777, 272565045, 268666048, 728937246, 59009179, 442416491, 358964761, 786109051, 505480067, 425679492, 136332306, 577495246, 625930981, 113300005, 21459230, 745470074, 650964189, 42042132, 308666227, 705345213, 222328666, 707886023, 199241267, 692320454, 798448220, 413224899, 227512815, 553611443, 106183408, 548992638, 54916985, 278635256, 672615725, 457818761, 560728380, 624018691, 538384552, 292838363, 280229666, 557350091, 257625806, 777905084, 379352193, 195280629, 608961738, 531434368, 724490898, 330090146, 715954999, 586545897, 259462760, 625366263, 376209840, 665717238, 106219699, 712500125, 684706220, 799501355, 716130995, 646653452, 589986969, 395839615, 318614489, 839546584, 144024633, 832871607, 801223350, 706367343, 290191636, 502835867, 693028665, 849507940, 588503407, 724443387, 479440074, 811466952, 186474911, 692797128, 769913161, 115585323, 540953968, 505446623, 191313948, 456197066, 191434097, 803176822, 574742504, 516812533, 450177662, 227878227, 327483469, 546066800, 419439200, 767152005, 286503670, 65140243, 456602572, 637024296, 531450475, 831310841, 815430594, 824392306, 830069654, 427522793, 337409522, 302235229, 412527245, 82915044, 452450773, 507881898, 283603322, 138278698, 432256575, 841518424, 456731704, 142227302, 213595851, 204164156, 200116446, 299478080, 148557019, 587894840, 490273630, 639477611, 36821849, 14315262, 242338153, 441243488, 281542155, 482446094, 819642102, 506642299, 200152266, 380196954, 693775454, 762646462, 392861309, 724206883, 67461198, 137805242, 147806011, 836917790, 529698837, 828236308, 530010423, 706329054, 602863080, 251827209, 578189618, 786874111, 774332559, 634291537, 745161222, 604119350, 203914382, 294050779, 599113788, 804185004, 299940527, 3739551, 237171818, 45011366, 567995049, 635567399, 434942197, 646876393, 549209661, 338050067, 495099845, 118980483, 55737985, 672489722, 134880922, 325198745, 188921832, 27102490, 752864010, 158189962, 366951859, 665763934, 512227404, 79285296, 252497828, 645750804, 377519951, 579762467, 146602324, 844470974, 205293420, 844389663, 16604025, 191702212, 592543510, 833665259, 458039490, 384781532, 212921312, 154383338, 388608824, 746128168, 415048057, 725744265, 836422008, 87518428, 416846765, 280700001, 798277428, 582841623, 563822629, 814433155, 25722661, 77451135, 400261903, 572695751, 418463702, 63012418, 832170916, 218616653, 781493315, 718915637, 589375471, 699778735, 823090811, 469065660, 607485742, 825823047, 358884219, 445939309, 373410439, 293480569, 322954656, 360400241, 410332554, 839119397, 83764694, 12888546, 854962341, 609744951, 503953431, 1221709, 148394650, 258025143, 225173448, 769282405, 845058601, 742108943, 526307407, 207415243, 379528837, 783877686, 364133272, 179747318, 605367949, 561872914, 297683893, 62819115, 379915029, 556835280, 260241070, 839494547, 634518867, 349980215, 280711380, 106017839, 847651834, 390252330, 416963004, 34685591, 113550525, 83937503, 747668096, 507297983, 597694259, 297770392, 14201467, 205620120, 137504239, 447031730, 154112991, 539982833, 41560344, 98497897, 522554400, 368174392, 806489415, 331938830, 236013706, 789192808, 818020216, 493631149, 345252367, 281242178, 708821621, 379277555, 744014833, 492548180, 392304807, 718791492, 119775104, 680017839, 103495778, 258288431, 521559402, 762458253, 700652478, 222344864, 401634229, 121530518, 292462631, 20024639, 490956209, 168828909, 561180702, 735067963, 119291860, 359779028, 307831597, 524979090, 775182194, 115715237, 236173773, 156996095, 73986503, 415113121, 802142583, 63880857, 627344389, 494422913, 659511758, 321602722, 778755315, 244024656, 840248646, 88385807, 362360888, 367135443, 552096953, 823139302, 221488629, 772662232, 495135811, 74509271, 155260335, 90007024, 777043679, 217636978, 690435577, 340247280, 217916101, 13510111, 531116441, 249013560, 227884889, 114591516, 821679550, 516486184, 139220421, 799736809, 263355771, 426584594, 152871254, 158792360, 581148163, 251368439, 156018031, 133231865, 807618688, 70221679, 754026062, 114761626, 91869049, 263321863, 323337131, 629754158, 84946399, 663949312, 131231199, 735918318, 114461099, 553510369, 733960916, 605655391, 607545956, 792010958, 831802840, 158016058, 238482500, 96771080, 455976701, 664684217, 320802852, 788150035, 797352763, 470155457, 630675304, 309048435, 169782032, 99361178, 681224300, 226356583, 757573857, 782438656, 776606250, 152887302, 45377130, 295540138, 129238624, 165562952, 815012329, 343505647, 159142220, 714972074, 616997877, 404268756, 762933006, 271449128, 234655501, 586192661, 222836389, 307248726, 21390065, 822742773, 753761820, 626904188, 746503415, 302360546, 167437531, 307768875, 821581359, 61469206, 193701143, 287417633, 402725411, 58196609, 76082484, 196053620, 31253778, 759484558, 250991782, 618017635, 661398837, 148685724, 136499100, 664789995, 476421077, 533107152, 250660156, 41923231, 492030734, 596464376, 829082904, 690256418, 342442261, 60183765, 670551593, 776901553, 23461980, 192377032, 439724719, 135255063, 496542340, 26198783, 466989460, 411015691, 462108919, 501608656, 677284903, 558338134, 56806307, 855988668, 756048380, 621833686, 425883487, 551398698, 106397563, 768236325, 69692157, 102044607, 107420904, 332604258, 172543357, 37722834, 504168085, 512298323, 422987885, 671676567, 202441483, 707662499, 750065959, 576980477, 651637643, 77225158, 805036709, 713595322, 756370866, 103470486, 577326798, 299674162, 322525614, 31519397, 222130395, 476243403, 213657728, 451745748, 144747257, 339279538, 211216416, 205869334, 487162128, 248939387, 728975450, 277131335, 734917943, 759729115, 145226065, 430071815, 751346723, 66094058, 667042268, 357792556, 469263507, 447149678, 738661054, 817171482, 388799079, 303051437, 38615468, 434784026, 67679792, 624060684, 479302334, 703549336, 259125820, 698782447, 365491396, 672808746, 32628780, 133311774, 707999615, 498457399, 736832462, 203254928, 375327306, 835837328, 255247423, 463233119, 169217601, 779744711, 756019950, 95616934, 685763309, 473753934, 839857964, 135889868, 74197842, 339287030, 451052631, 154562657, 517659863, 152580907, 524910861, 345747569, 237064434, 616226834, 228392627, 24732246, 71815815, 128672856, 376355411, 222998397, 104306772, 769318461, 780500445, 246809852, 125637065, 674764346, 811474767, 641500703, 477760929, 635129115, 751289979, 414542889, 463991284, 147713967, 532563581, 93376711, 403865721, 112683924, 568576544, 211652356, 705885926, 52206026, 393123743, 567072826, 114982532, 483816577, 640519367, 807640369, 65939139, 249436504, 349556752, 24780682, 500832625, 742735193, 454545355, 458382195, 201286521, 746471018, 461672691, 59642494, 586978214, 753828663, 423393659, 274999060, 811488078, 557285937, 174571616, 720801610, 745576015, 792536806, 168474894, 596872790, 164527280, 690559118, 67838272, 643099841, 818480058, 604905467, 346634014, 581392471, 774240203, 118001663, 662210464, 698968021, 413128677, 649901336, 239483662, 384197461, 83104887, 269879993, 318486904, 787006961, 812117356, 383243376, 612560357, 631984270, 514129781, 665149761, 485434739, 280644734, 312061271, 321670447, 18635113, 44481840, 532961479, 417074943, 144509667, 829854681, 707209591, 371157568, 689760312, 507812770, 565339133, 395103945, 319744965, 604787643, 555092092, 681535934, 647313877, 587947735, 731607172, 445862443, 85081303, 730784962, 102191678, 819783830, 802275232, 251242743, 812821403, 485356599, 589519080, 648469293, 133257035, 252490141, 823681660, 481739769, 593146428, 676316655, 478533333, 261499583, 164568292, 791791456, 284166493, 646696895, 139739813, 87506191, 283475712, 48560584, 667879082, 280125890, 729531360, 420375493, 611636386, 505227098, 280268217, 621058329, 150277602, 553530872, 394064590, 627010841, 261516920, 608272658, 245952213, 593453354, 59439873, 478196036, 716100026, 10417198, 670667318, 79250249, 841075582, 839041717, 161062803, 117440162, 327513016, 742463417, 478037184, 694597108, 150679731, 309935423, 354022600, 509194354, 748783302, 611581214, 321880844, 511311853, 550988096, 496699411, 549088487, 1991464, 568597434, 682660376, 737482630, 460599314, 21810936, 821358600, 736238239, 610374428, 392147112, 748788378, 58119536, 81987210, 600594098, 624610234, 476469849, 842529043, 350290526, 80200603, 452925023, 408525528, 118946831, 361187613, 123559228, 414829553, 464633742, 802765189, 177730207, 615987990, 310049740, 411001118, 503422925, 125318802, 569818476, 72825062, 567295596, 524110884, 270753106, 821579723, 665164239, 739916552, 139044620, 55893604, 61104896, 708497900, 516828675, 391250210, 701011341, 704245977, 58787297, 716669566, 364627494, 230586998, 833012550, 851527211, 181163229, 542542478, 751349182, 49813840, 383072721, 244074189, 359300777, 543109876, 785374273, 188826268, 357956051, 837803060, 562807363, 847412320, 470720764, 777415927, 612470417, 210832929, 832071025, 227527386, 184947128, 34995405, 100494708, 365573241, 641089012, 510164409, 843430336, 740029798, 429579276, 590041598, 58778219, 321415970, 662196999, 843976832, 11081210, 419158533, 308020145, 229930655, 256996068, 27501567, 117029967, 780056155, 683215398, 511892129, 573991742, 118461547, 143592954, 503414464, 602375851, 219496160, 279933417, 623855735, 793256045, 568223919, 403865199, 645861901, 849668382, 737320408, 47047088, 754960846, 465525082, 330221654, 3026046, 841094004, 223837817, 454374850, 450872961, 533256314, 407894430, 611644732, 569778096, 13451643, 419206101, 457109193, 855263408, 450459250, 568132128, 644486534, 150613654, 453962951, 81329351, 571098012, 428398175, 364949502, 224752360, 560482800, 310989097, 742858012, 629842844, 295745835, 789892642, 547196755, 409501770, 365107198, 838008006, 485254025, 67306228, 55210201, 280397419, 309894530, 397806623, 827183041, 8911460, 691732886, 598012348, 601846684, 473980261, 82905127, 89174653, 389624509, 606324261, 811397725, 400256958, 514127309, 88216561, 99937090, 626472416, 690973722, 428668661, 692476082, 14070750, 366702985, 311833813, 343352563, 182234202, 242235759, 186408610, 116805507, 820638050, 779840159, 347225544, 51788762, 736355838, 589462470, 500291120, 847790191, 598690403, 124535389, 302666252, 273771352, 156817007, 225992753, 745961024, 456511793, 455789352, 541267156, 668020982, 604336000, 842131645, 48644097, 450361489, 612740855, 419020286, 338496748, 327963448, 106179246, 5554956, 336793351, 114357428, 689106974, 770931999, 521608050, 40705743, 306313668, 381463867, 475055599, 557873027, 378733406, 477412515, 386616409, 138775784, 495916483, 548009915, 432461568, 310780660, 194374839, 252982495, 675131314, 763700735, 135879648, 497855575, 848272888, 445675177, 571868644, 577403456, 1208745, 618692017, 238647903, 815064252, 9898097, 336697817, 783368292, 22968862, 545130318, 623390288, 675402526, 759255028, 160160797, 569603042, 307813784, 697419341, 352429916, 694238116, 589784903, 411132029, 586441187, 40534501, 706786669, 791714576, 378113860, 129174594, 725449323, 484807384, 310689899, 57653598, 483572126, 269392405, 321564998, 184728622, 421016410, 762943405, 767531442, 595390626, 717858924, 261199437, 242463944, 631573090, 142227560, 495394543, 42427666, 216821342, 777008915, 70747018, 176664286, 360965183, 636669162, 41129775, 583927907, 103799344, 559424501, 623724165, 595913233, 621000727, 21224066, 761362449, 855392454, 649449554, 35878802, 791662388, 45505834, 839856465, 204715058, 108455445, 222719911, 488847720, 446412081, 113860660, 187911114, 550592721, 87071943, 442504207, 325853920, 138886372, 244492107, 321415690, 683893553, 372223514, 259700100, 617280770, 851685367, 692177970, 7182098, 682374680, 545452940, 328599237, 729638699, 514972493, 555377115, 713421823, 793393320, 117745677, 454531680, 762685269, 408140678, 425205981, 30083959, 740459165, 454389259, 605949600, 796494469, 843083504, 499394970, 719867576, 234192868, 790206570, 564068139, 482177303, 510548682, 775482552, 417097691, 21695810, 171813056, 516163859, 319069330, 698665677, 179237599, 278317942, 56279433, 574965047, 538698877, 450391996, 515077383, 45754191, 549600399, 579823863, 342891087, 638219338, 820410886, 525828333, 842136336, 514686746, 327222239, 540820912, 3597383, 253967070, 254604519, 148599482, 511143098, 142089742, 106821782, 541005826, 843956923, 282100919, 632401902, 90770636, 230135896, 427872280, 718381642, 578729636, 435099159, 846672294, 541476300, 666881143, 621139895, 27248882, 230963094, 230045858, 531424579, 761445367, 303286397, 394265288, 848893665, 811072571, 602653902, 502107553, 549404559, 194955984, 688147100, 130232586, 403707416, 171667877, 93101407, 684446047, 328157745, 397654830, 653624192, 504989439, 648612193, 705874143, 1273423, 649502453, 567272110, 294662819, 385253566, 216285362, 551503274, 663982016, 487418008, 259861264, 557845980, 569535177, 341073140, 22546870, 316487903, 200488927, 226963852, 315723563, 134321201, 206661327, 232680814, 634697374, 353059266, 231247844, 593414318, 661842351, 179133228, 319375816, 748730175, 38230533, 192214652, 165084886, 22777105, 357622090, 575391662, 444481962, 450739337, 840098843, 100410856, 236665789, 719688055, 22934479, 729753552, 67514337, 132862685, 244546007, 58732599, 236076383, 355276724, 602434072, 386798455, 736495516, 545376469, 144011000, 330246101, 316301937, 254526843, 337067873, 238554484, 133030151, 558865361, 102081015, 326979298, 525284528, 782995969, 291355034, 266988959, 814508115, 744585867, 536680992, 625958236, 402136542, 776414717, 269361958, 367078595, 151662282, 463212572, 837662623, 136892524, 579955895, 539842345, 300726988, 56358915, 422855834, 312940039, 418761419, 829085977, 58925395, 129253971, 297652748, 541475563, 437712346, 847933543, 146454713, 668417966, 848607562, 560008429, 345570813, 652748404, 535112932, 265515902, 89373489, 729433190, 432760640, 207002951, 656430609, 556401760, 436379744, 146443535, 601534607, 355432200, 366234079, 338778958, 524476521, 151854762, 123680693, 47493931, 385256835, 615935347, 496158928, 216896218, 115203124, 236414630, 466079176, 463883475, 212737983, 442993550, 57310039, 853316503, 241919151, 761408615, 24221711, 204236020, 736652562, 369937914, 819965401, 656390858, 845081028, 828935962, 226916755, 736085196, 847996822, 428706740, 53712636, 366199469, 686849653, 735200524, 666487029, 617354906, 17220063, 153783103, 704095174, 681580956, 501485273, 606704898, 129168941, 265925567, 246394079, 196294099, 31175526, 199297820, 14103989, 673772430, 798231606, 561961182, 490364901, 606595349, 557152046, 486110400, 656182813, 222191850, 718275108, 570551880, 431006154, 467672969, 231638394, 338707093, 652124488, 91112912, 469244718, 694202544, 474641235, 239505620, 603395255, 527415987, 85756008, 7718135, 386800621, 229902124, 325667932, 207495104, 523900214, 415642541, 359794240, 431591164, 650675407, 760324117, 281105768, 400816524, 826869746, 72650038, 346318921, 699936100, 777310924, 112939542, 298135457, 227850051, 643765404, 700864624, 56994949, 548374219, 664395827, 36441012, 410851748, 18188737, 31270759, 164520316, 826359058, 133809608, 588296337, 685838234, 554281454, 661762133, 116187655, 802514484, 844132448, 348583871, 147938933, 73883483, 577204006, 226377326, 89618291, 541341613, 482412885, 30612784, 676643941, 830674499, 339604038, 613623906, 77313974, 213067835, 783466026, 60773491, 459750381, 626460423, 95440631, 505125739, 538449660, 850270724, 147259039, 21162544, 316599344, 534208626, 201789516, 199259449, 12894892, 128171013, 305410603, 789267948, 838885052, 692336217, 186960095, 659410096, 546736607, 25682564, 230242100, 762307685, 36785983, 507753125, 218894879, 120965866, 635798197, 120037909, 27852999, 346802305, 682701940, 421233510, 364198601, 299810632, 591589780, 657193593, 70684695, 222611973, 813425918, 672892241, 767652274, 309853533, 505809546, 854753364, 447855915, 429416707, 693676920, 119622137, 792946669, 455966735, 293260233, 407990299, 789596041, 663733623, 465084574, 301905246, 141733383, 460223689, 188803735, 662385191, 49399040, 479815141, 741665907, 554219411, 32819251, 785578026, 763398394, 326099757, 473409542, 411965033, 227182616, 196249816, 300606905, 178161035, 239541487, 629585582, 569155473, 669154698, 216088501, 281453069, 276167969, 416576945, 61373673, 266219943, 555976832, 837502966, 40247593, 803547228, 502499047, 553250331, 666579573, 546675458, 267455366, 96316455, 300666309, 49662860, 855536001, 204767423, 167716167, 199116301, 399612605, 460699681, 804965575, 600275741, 242218735, 319046009, 247657454, 126582361, 443319396, 213937074, 120406160, 698310983, 358244061, 827731404, 361800712, 395404294, 192845931, 40912274, 485577657, 537826646, 131724945, 794728823, 460877452, 56156095, 524881787, 480731682, 721069190, 519004310, 793988355, 510341115, 793476552, 723216444, 585922697, 63127284, 313502026, 797949258, 138279444, 339648312, 293527363, 110104339, 491499110, 523112548, 615383608, 304920950, 128746314, 137762196, 767804675, 407343376, 159794125, 561433231, 208037109, 472975767, 470229277, 634627963, 678971696, 419750796, 159961684, 32718610, 834050504, 216677213, 192725378, 581856916, 827006024, 103275311, 631361001, 205636437, 783267626, 292286046, 383990443, 327208367, 629965196, 336327086, 452430520, 97254498, 206981708, 155630868, 367788464, 528542541, 378212286, 62711242, 622724838, 822234186, 718156849, 55168688, 761734560, 165494695, 122548243, 596052843, 20841008, 317055981, 101172703, 553687448, 413616116, 463762168, 317196146, 94360371, 611670605, 484229938, 247544396, 102236882, 339774020, 7237219, 245090748, 509168708, 134713630, 351797258, 215167798, 82010614, 168984198, 179187292, 337759491, 634258036, 777731063, 538255064, 850983831, 48886475, 759017199, 388183281, 42752525, 606376024, 809641557, 735991183, 149613490, 814921892, 172298039, 431798064, 482581535, 95458628, 175074161, 398705422, 378821057, 51532857, 431552469, 59949129, 380348533, 156597063, 545706735, 823043192, 517401532, 801795728, 184216123, 225413064, 200280048, 146463216, 542129946, 550437325, 511405591, 497570881, 55485113, 478520277, 296993452, 625770287, 746088328, 283267715, 503337726, 814685706, 752930300, 111922906, 336900401, 260515064, 21369417, 313875293, 109065055, 509646434, 338228591, 720335422, 362908324, 178774256, 462777065, 25834182, 760292740, 368603148, 770555089, 208484188, 178103748, 663139591, 63837398, 391375322, 228054112, 835381556, 120669564, 143099709, 233034803, 271122766, 215379315, 144976490, 673091535, 508470648, 205191170, 438850393, 763358727, 762704410, 636469934, 822610893, 280901520, 443415591, 116273753, 784384610, 198549540, 180927037, 238780192, 314409486, 256280053, 166155637, 579203508, 9731577, 448717485, 401005567, 100003357, 393081718, 633576593, 767334056, 761330819, 820331029, 482751847, 687374144, 504684692, 476577177, 324326327, 247732084, 307244730, 306312749, 516015583, 740113859, 599326633, 568589001, 484554358, 692404236, 551551843, 618925003, 214343102, 142199195, 470528315, 582823152, 546875691, 771688264, 532236766, 108966246, 826545356, 407328821, 454721643, 182629403, 543342677, 413270226, 184927474, 233928323, 374614091, 804768403, 586969888, 607512351, 570864659, 732780099, 743838873, 216401791, 690528533, 626835088, 209838008, 322330351, 121469715, 273611442, 61464696, 122603995, 419166502, 552722509, 709576717, 71555583, 441902633, 679509448, 664521118, 723591249, 463056696, 620696634, 563948249, 165550649, 356305160, 496249124, 146375072, 383979790, 751435837, 352013734, 802200728, 730317034, 435046212, 481297404, 113114292, 11711190, 280917913, 189537841, 719007454, 309456952, 45672436, 449986472, 699778373, 666436212, 592529599, 154549000, 637574460, 756641876, 54220832, 78989340, 624974716, 389157912, 289659506, 575506015, 4402938, 721636810, 109665115, 573917709, 324945906, 593449768, 543110649, 470417463, 476088290, 181332350, 607039543, 685217358, 764612165, 308307112, 412124763, 537702734, 650922370, 476424725, 153444708, 89680564, 5387127, 33516703, 638814152, 420348618, 371269302, 653671469, 477694608, 548648656, 848179962, 434899499, 32632471, 573635150, 555782462, 337237894, 561934355, 598666098, 261560991, 96199310, 432589977, 680911692, 370574196, 333090802, 672252219, 164708767, 12222227, 405401327, 357469068, 436523211, 54760239, 126567527, 504792063, 776302516, 406891578, 785375055, 311077678, 587995722, 773874744, 387965599, 712243499, 281973972, 112093633, 842357212, 102348781, 702540364, 552750958, 270536376, 397855961, 486552323, 276992885, 417220829, 238197435, 700052930, 694486638, 810885222, 529172893, 524570126, 543280255, 341987110, 455225325, 284408452, 717466108, 354645280, 501631019, 404169333, 206179424, 853536393, 549251585, 652548437, 528279328, 538525867, 170042820, 358270822, 243214631, 3581162, 274677290, 141589718, 761402842, 238359433, 672109003, 344611522, 824787164, 173132832, 148288411, 642644525, 99146803, 501000848, 372607952, 149421630, 646163723, 365034362, 714653142, 178299735, 261934352, 340830441, 175242185, 295229726, 379936049, 62972265, 91677524, 599586428, 243476117, 556664509, 123068041, 360918281, 707665606, 361715199, 314687562, 229083958, 629323853, 55379690, 216119989, 58387497, 255645571, 42548408, 830285906, 564940746, 499199426, 781087950, 254102411, 301128433, 725359045, 283223156, 449229345, 218716549, 803449761, 197656514, 830917003, 436508717, 846248181, 249013149, 565890581, 161759764, 842293967, 68184350, 817502854, 617541057, 7756246, 469234948, 309426265, 802707555, 358698378, 469058216, 834290724, 177112913, 588124077, 501547968, 175290121, 196199397, 567602788, 471386434, 321209989, 61233277, 578972450};

static const int32_t invnthroots[PARAM_N] = {855309841, 0, 186175163, 104450202, 317188002, 268757422, 345019260, 833380160, 206682942, 802147008, 69968980, 709658959, 826861778, 568076336, 527080692, 81988026, 782036975, 216922563, 463195895, 374796853, 316836583, 239052294, 255826953, 444636592, 411067908, 773130824, 652132735, 37197322, 526705763, 804115937, 80212219, 325021530, 400921021, 96708695, 478110039, 629274170, 98069507, 171469699, 480397420, 810445901, 788398187, 153797169, 104759654, 34222261, 276953535, 623661599, 792382335, 687034046, 794583313, 426883643, 263220200, 221208741, 313650184, 585548463, 303734810, 531161347, 143895289, 301763384, 601512552, 238830570, 46155535, 194473798, 628987956, 714674280, 463886224, 743754722, 633543580, 479764001, 40495715, 547979222, 813602664, 465068978, 84588893, 26585485, 673013777, 589935946, 473041557, 756419628, 460587558, 178782849, 393225840, 195639223, 609739835, 727039727, 478403818, 142443776, 187797818, 284466026, 427773259, 541782389, 776083588, 525499624, 820684355, 240444707, 432117931, 538157778, 16330076, 673546509, 750494308, 439265805, 511361651, 84488280, 336782370, 375552355, 271958615, 184366238, 116485621, 644142532, 675105092, 581647485, 122607476, 490928966, 15985470, 397151466, 480855467, 176973595, 606853551, 560630808, 810081178, 489368666, 175880587, 707392793, 808050636, 791845733, 1329041, 85992639, 174794197, 169297948, 97334371, 627500181, 198162896, 346812352, 593437217, 844115517, 117413089, 704986568, 728648132, 546702376, 295391671, 736837926, 840809165, 753814827, 590815237, 492727010, 301856748, 463599694, 219881261, 601441811, 308143939, 36985249, 276268968, 596550624, 47444322, 132903989, 114548221, 578479782, 558651289, 445165382, 534054707, 278725620, 352392146, 140160359, 371130132, 492618043, 810754333, 319205478, 25547330, 45525008, 434455902, 674973100, 12022450, 438381534, 138060295, 382219917, 219057260, 506938543, 333042711, 19685883, 110972887, 23333102, 829444311, 69491812, 592567272, 648647154, 697033283, 524407424, 585103298, 782131441, 10077562, 46518276, 243165356, 468855785, 86390574, 606982644, 705761984, 852331584, 157607890, 194929520, 729845160, 352481997, 805878865, 225366620, 508479585, 243650742, 635768755, 475567850, 247194331, 47886491, 167668204, 67015848, 510657747, 380588897, 394225226, 427167002, 845969827, 63838392, 610747743, 397018270, 755876345, 576628002, 198269583, 627581305, 60402680, 547856337, 625226105, 748080271, 728952086, 483374715, 840817886, 667434647, 187855133, 550190814, 793805755, 537370995, 653995154, 175173216, 785609729, 22395811, 767129425, 43914458, 686392774, 299210228, 457019443, 701553599, 606692059, 200090037, 593240221, 343490014, 483463560, 811229262, 131803185, 9356784, 329888718, 595569778, 73324240, 376349313, 456167522, 465397427, 272862124, 738852795, 61350565, 341491313, 732898937, 694947297, 556464638, 444829536, 747362928, 567785051, 735533048, 740383012, 403924300, 854918234, 283869321, 422210897, 492180669, 311695579, 437520114, 439471040, 187515104, 478897154, 826240937, 509242800, 353775389, 32174097, 93915278, 812702510, 283216593, 449066212, 422965868, 716091996, 854674143, 313869527, 41625236, 516555862, 546170572, 278985952, 813733414, 692970575, 538553362, 256696838, 776104950, 395919718, 677287142, 219241443, 478411690, 718825203, 682157696, 9672996, 532489354, 593591572, 233718251, 200484616, 291310243, 479206468, 549634862, 509511099, 134715389, 719558362, 367059989, 207093431, 601470525, 610229101, 432152564, 435638169, 216200181, 537322812, 101058202, 680794097, 284557233, 819727176, 273452345, 53859291, 409342540, 384895344, 192827824, 414552650, 13572866, 809105311, 378924139, 547685477, 57358715, 99525847, 228782757, 701318194, 758695995, 60975296, 36372878, 47606235, 481115943, 653425200, 119730411, 270796699, 830698712, 681819603, 168220340, 136321298, 65360347, 332877179, 357796826, 72982876, 417245671, 201116195, 228991068, 597749460, 88619439, 608140601, 8284223, 524438848, 639931044, 504817333, 316203264, 419632072, 169098285, 8017248, 617158597, 56356205, 485165747, 510837813, 371551331, 603549920, 364772623, 683440560, 364292135, 684657372, 119033122, 634967908, 10436882, 340579930, 455762402, 839950776, 387961473, 730987918, 840380077, 781573185, 509080522, 575169165, 815879326, 61066957, 236382690, 382863399, 55550628, 705971446, 495318529, 230606097, 364733011, 81840865, 274676067, 359185956, 525673441, 360030941, 285478271, 506379045, 179686030, 712975424, 447919364, 681304346, 796755784, 551244581, 533607249, 719653282, 475707943, 657126929, 357998453, 758750728, 602640659, 744327527, 618322329, 339822670, 651509482, 547084126, 42796129, 227015964, 640351010, 337641787, 152292289, 312396146, 381853441, 83097148, 343272780, 657887437, 158305768, 688598233, 411486399, 275127153, 580545675, 632014833, 742175151, 49458534, 475668320, 851467141, 640376580, 124905160, 744815370, 456030216, 111711220, 801745881, 311471836, 312753898, 306969998, 285414139, 59835877, 336064207, 766873687, 4630343, 849810602, 383788469, 243649128, 272716216, 735867985, 790722758, 772970850, 502360465, 15291293, 314890592, 228486382, 665769554, 690552100, 27140738, 270444087, 438747551, 582911546, 159491312, 535090605, 759112142, 477695300, 32513061, 102262947, 643247738, 330902557, 450106837, 235429202, 76134646, 607869465, 846967247, 749670627, 353401860, 661399216, 361615827, 614788496, 438667144, 62917024, 328762049, 93360696, 572936051, 656556728, 330077615, 487728202, 180401630, 836301859, 515459051, 851591755, 679414584, 647871427, 34348194, 813537891, 764471971, 760721004, 405030231, 642157682, 460033220, 302009259, 167602643, 422358812, 292333171, 724499465, 312881823, 100264610, 22175732, 46270787, 12095920, 16659882, 422103582, 114384299, 216125368, 606595360, 69396000, 313187875, 291489329, 494036861, 281101839, 644575962, 432035966, 836985109, 528596850, 518947325, 702014417, 260376543, 726978240, 759827342, 107515646, 689793201, 445513416, 277363377, 623597550, 402368245, 565530308, 161399364, 83699639, 170785166, 538410440, 456197523, 146506125, 669882659, 501807971, 271709144, 410580591, 392419773, 4055233, 284279793, 261498451, 792800901, 94791432, 816323260, 468184134, 295280048, 430586938, 217906630, 731076714, 221654404, 647350223, 16334495, 96089851, 393722704, 49120646, 61945422, 81336598, 369879005, 483279115, 772362626, 254138425, 571513747, 786222627, 117974798, 519820689, 182829116, 718120569, 330396072, 801460307, 776706589, 470765415, 422333865, 70420548, 443663691, 770195997, 735488829, 381121807, 627866992, 317549736, 127950778, 375382158, 505393543, 792568254, 814154665, 597261679, 745002940, 92956522, 726346118, 697904291, 79718748, 446356428, 258271733, 296960949, 795450283, 259113853, 12512610, 330696258, 555431638, 16815176, 683712786, 638343645, 374915202, 786345380, 597472742, 802434169, 779544596, 678672447, 16263255, 206504223, 769277347, 577216226, 703732534, 177015068, 145105357, 146472148, 176035047, 387852143, 582548521, 552318112, 540333890, 756195689, 473642185, 487713541, 398675521, 195425736, 404467444, 160052643, 176120894, 231001782, 23053032, 185060970, 811777124, 760174820, 490792734, 665325054, 128786765, 390257667, 669940700, 801541028, 390575502, 215116155, 247133332, 343799354, 49180233, 694632302, 455680417, 556226395, 651957187, 223351471, 330922352, 572357184, 217433254, 792185182, 89452602, 169841487, 519427279, 663038013, 479063035, 596320114, 461480828, 422695213, 627779388, 203804071, 843628375, 85372677, 710068170, 767524204, 141353487, 760400190, 54552952, 175959869, 475348596, 566631367, 812782264, 610126588, 682725811, 309584181, 532959188, 678014500, 62826782, 570058265, 768869705, 706992842, 456021251, 648450979, 737173917, 226434669, 776308393, 79720319, 414500646, 273196009, 160949978, 84567823, 173155839, 747196228, 666042252, 524420791, 430918672, 197604077, 581068239, 786934609, 701614143, 85288180, 460271454, 624022976, 418330677, 497341376, 572772345, 234128826, 258757667, 433619915, 727802546, 2453202, 257806319, 675861531, 703709644, 90162956, 81917790, 22957884, 259332908, 162677125, 182528489, 424806503, 456892392, 290344553, 401842503, 543560946, 787546699, 346712469, 513637647, 428144396, 709508814, 616707725, 435697369, 816304394, 636386793, 310788797, 133265888, 316625759, 333904809, 819871975, 220865756, 177552446, 84327234, 741225228, 408595355, 792256891, 562912384, 45927044, 462591055, 612716892, 25984412, 815301431, 40990317, 312827180, 56248479, 407908983, 834392170, 114102785, 500409905, 787025455, 580588761, 228227597, 249313056, 531559171, 423929895, 694051299, 475205331, 678722026, 496441771, 144898414, 23636068, 375891216, 296592142, 305778053, 255206218, 40836747, 178393364, 330866036, 27786430, 186136770, 489964899, 203670441, 260577067, 397429309, 200912971, 126608166, 54157540, 355631503, 707534897, 158478976, 292079677, 572996904, 223867640, 494122037, 670389411, 294502830, 215365714, 748489376, 175965135, 468720414, 563350245, 293373161, 504323885, 447744635, 633875821, 557829422, 254358707, 761132353, 507990900, 171643951, 807609264, 615361963, 261241985, 104213822, 8268319, 269534871, 720925615, 767295891, 653841171, 794505499, 757303652, 384068015, 504146989, 446877899, 291521006, 489241336, 836497845, 73350298, 685674244, 840478901, 703418770, 583595744, 855002087, 125307682, 416506600, 155011717, 272707197, 192885843, 242711215, 59358167, 495487506, 828235728, 192801024, 654664322, 658508465, 432288258, 794899262, 493788426, 650200395, 119022721, 148030842, 219386035, 57293276, 103983927, 596686530, 328524480, 115650835, 614343764, 257358851, 121756089, 626727987, 160359574, 586949348, 824803639, 703064508, 596462538, 623350477, 677510033, 768293127, 832506977, 274937236, 342305110, 228237084, 538493774, 294891908, 436826101, 297531505, 741573582, 671787481, 753745586, 143714490, 507892762, 845391867, 139686642, 1532781, 396595640, 150161223, 677348343, 263686098, 758627972, 408673422, 657151867, 815017876, 847789477, 641040094, 324145427, 406698380, 682409496, 420026043, 704576679, 665655312, 615036664, 844036854, 166294889, 681942889, 810814094, 812780953, 254568451, 555634511, 781517301, 410621194, 41604083, 575207133, 249107401, 171333428, 764142083, 788221589, 164708496, 842676079, 536742634, 837522527, 441704374, 317483426, 846402728, 388042487, 82201678, 174780886, 195020973, 803825386, 613510197, 98726529, 657236163, 349693180, 229044487, 228733624, 86813426, 346753891, 166979219, 363949878, 89595606, 721282397, 362109178, 70139702, 716945492, 817866640, 272248052, 410778359, 345664882, 563574223, 89157152, 247953125, 516825074, 801090788, 698593629, 201432359, 304478979, 450686705, 403253944, 752037417, 700895159, 77597327, 718684631, 364375874, 340820041, 25638653, 24089913, 10774420, 666532268, 361795340, 706791327, 403012991, 82842992, 461008887, 94467374, 699758842, 507267506, 494727472, 355332820, 375127711, 404104255, 287210670, 420555929, 783893148, 829258666, 429654842, 790272373, 669947134, 152812821, 224372937, 641687115, 58224686, 376587787, 662310884, 74033565, 720331104, 720331104, 105054798, 413395679, 593153244, 377609026, 255044152, 736913178, 616943824, 24409444, 705763198, 647633101, 204008945, 573447190, 167536277, 196984317, 430154320, 633986341, 735354127, 788576, 698949195, 748537509, 651122605, 176720379, 181038387, 254558588, 375292318, 40747224, 335421222, 715417126, 418335573, 505706784, 345885699, 91976960, 388429686, 807077634, 430464218, 824324306, 475232528, 560248118, 560975005, 751521853, 292810040, 306604802, 781076684, 202832135, 678365406, 328221332, 28440461, 148145994, 223651982, 21063301, 455439310, 697193126, 12627349, 384930803, 55572156, 505036020, 397730114, 585711588, 323650045, 32526158, 558128232, 771950180, 485510397, 338772960, 344473663, 802665085, 830615924, 322424249, 338886226, 181375444, 224135169, 756178520, 691420448, 854117211, 794675905, 710969709, 400417620, 249699106, 84223081, 236721273, 608133861, 414148334, 234321885, 854117365, 349063718, 771980208, 689845424, 165936597, 302808044, 325441819, 401873217, 522946179, 709831059, 595678645, 36360821, 316861184, 67442824, 263603971, 510407135, 101481002, 320658946, 375792275, 327125872, 738273340, 750802796, 71580398, 567316855, 385531694, 495005305, 393909721, 617856795, 438311276, 335662480, 145759094, 765787865, 98884286, 447576173, 615140529, 285691538, 588108705, 433229668, 89344875, 162760059, 562181946, 396969123, 503394467, 790209888, 855282984, 237697693, 560785139, 66351121, 431844026, 433100262, 106194044, 208830597, 670222278, 338669801, 425824588, 846532472, 298593955, 482405743, 368213073, 438731984, 100808675, 545222300, 171362225, 488451333, 610116206, 548444970, 455457709, 307439476, 205752565, 645913449, 79436129, 372605217, 42657993, 466046127, 558317040, 802567688, 631546100, 287126320, 599231007, 467742815, 280874234, 483987980, 546266494, 671549158, 463192831, 156324369, 526505218, 396658002, 532719168, 454048850, 180741620, 524906742, 242081120, 426069436, 410659468, 214096153, 511626377, 204139306, 648075506, 469690455, 811031357, 573815288, 29587053, 338330320, 192227282, 552369264, 550018259, 43131704, 238717512, 43778943, 659901650, 295309805, 324451170, 95766864, 843199614, 592065304, 237930078, 843720880, 608267290, 349087670, 771623520, 349823521, 229099218, 354127143, 797010350, 279837238, 543371935, 548525238, 556098042, 716067437, 664923612, 295855223, 5886532, 220746420, 14599636, 102721958, 447472220, 59080871, 675550696, 663547660, 15400462, 589138395, 839761073, 204317857, 238521633, 263260354, 94815860, 689275646, 266406849, 706634749, 417361683, 696085394, 796059179, 60517597, 563403233, 91290008, 578584064, 109511763, 703065888, 383579589, 38449507, 487297877, 270422932, 213258447, 248572296, 250228108, 228491904, 327998748, 234326165, 256225309, 420843763, 453302116, 234331978, 487708340, 716863255, 721298262, 806406678, 27466993, 375962440, 286591586, 381205058, 214313312, 226492225, 290256225, 801169181, 564631507, 721599887, 665680392, 587508870, 250455238, 413199135, 378487405, 849822912, 325203417, 345054468, 151460614, 679099770, 662751063, 45510419, 85237851, 206266406, 81047152, 124611430, 376335797, 161485863, 676471808, 463588988, 746497821, 607255993, 464656543, 372226118, 753014083, 797865788, 49640971, 595739197, 3060329, 777058490, 809999035, 481219622, 543306555, 822728396, 238423923, 640866061, 690286471, 254124881, 554339239, 253018109, 569675228, 105072013, 546434298, 267732120, 116717200, 118106188, 451245324, 93266699, 552605884, 414763199, 542090863, 582484206, 756733558, 712801048, 202565231, 233467731, 22977606, 819511895, 80910370, 855194605, 45068334, 72171194, 189292590, 851374793, 59324897, 160735413, 588666569, 118048986, 709156512, 499392957, 630568847, 619597399, 362750742, 703275453, 776052721, 468496656, 149614709, 658562487, 539685071, 687357680, 75820421, 533360796, 653429333, 515968465, 113067369, 737811002, 44756132, 287722273, 548121495, 757464281, 843110005, 287367930, 265101754, 254215689, 690391508, 107381843, 317822688, 47938858, 81483670, 382873658, 236463902, 645247069, 401873651, 765739238, 755374641, 166288732, 324083042, 788279189, 438559037, 33874453, 325968802, 235990397, 507967124, 453364975, 148778616, 475906651, 474180053, 210451135, 458097968, 478322553, 786017063, 746401669, 359045855, 73449383, 315272293, 499951688, 278637680, 14447656, 654046069, 94139396, 631753009, 677911876, 676894248, 80948820, 783847442, 847453786, 145550379, 812537056, 178069134, 278788070, 230591691, 780805345, 229824221, 379654931, 373893012, 78975224, 803722146, 333615753, 366569571, 120197029, 42523563, 687607066, 108545726, 238988693, 819390265, 676567761, 692631166, 627213676, 378161213, 768506541, 269685829, 223460006, 388007214, 663422927, 498341391, 572418852, 342336407, 20940061, 269939109, 519605091, 733700426, 678547554, 458823249, 837687616, 827616858, 5432568, 574528783, 824469038, 596842734, 59091044, 781610611, 744704176, 629207905, 232229196, 829597627, 576563873, 220030395, 818917243, 749336331, 383295639, 673261325, 565995380, 496946487, 469584310, 256404276, 339347435, 494025844, 368850490, 290905929, 165468425, 98457725, 425001263, 610234807, 563662924, 205037297, 125592146, 765426275, 282930829, 303989392, 603612922, 537767940, 723720472, 662280264, 801701068, 216612779, 672294170, 111302544, 248613365, 135024782, 392350341, 432155609, 370383594, 77810915, 71357628, 824200212, 173414788, 650085439, 436868458, 518825645, 641247776, 318195305, 19097755, 282188379, 167028132, 779249473, 789336908, 394448516, 178026267, 624886177, 455825602, 622853172, 634838316, 202811859, 560968740, 592189426, 387420508, 36416695, 837939032, 83741300, 772392720, 598443098, 724277828, 717601750, 117981676, 627090522, 524866782, 598707580, 535870448, 399203447, 241346439, 623068762, 446406692, 389579526, 463723845, 673207914, 830768247, 650363168, 103061709, 405398816, 632109101, 226598569, 499675793, 290337374, 659094667, 203396596, 33178113, 203076412, 604927127, 9799417, 783544826, 578722773, 627560626, 448098711, 488109038, 347935490, 355881467, 339492794, 4867176, 393716005, 213272380, 668767739, 299931669, 766514539, 342695768, 200825003, 95847395, 127700054, 160904304, 165486425, 657225283, 826360325, 582098655, 216990010, 6594137, 799525374, 476411288, 462328468, 171459032, 345058267, 292872620, 251540759, 401613943, 499251539, 198268370, 455791756, 855497533, 455746556, 251881166, 71382559, 219631890, 112960516, 770753689, 363595074, 734845745, 749916371, 208053811, 549456922, 848375724, 426132248, 568379330, 570355849, 442705814, 539528784, 836135088, 477537638, 32938819, 484056662, 665407775, 139847904, 260613783, 514707869, 400469127, 263578009, 628399888, 434599774, 95100584, 242385952, 414607783, 495947062, 821793878, 800612092, 821948168, 437486138, 833603994, 702010278, 604127310, 809679309, 226491366, 584404396, 280684575, 653738984, 135130895, 470521015, 749480926, 852578162, 555930817, 543399263, 776312937, 475801773, 427083564, 470943679, 137840197, 119480374, 763664446, 176713497, 604970574, 36904016, 690720321, 831611549, 840095529, 494602730, 266689965, 823824409, 125293318, 63098221, 561628627, 55865511, 117142692, 553994296, 681152966, 774311151, 787759361, 107135208, 698260936, 716903671, 69749716, 13267777, 202797052, 330943809, 482979590, 415868921, 572232739, 114505728, 86181624, 740997363, 11380961, 583535348, 260497415, 829901668, 301728691, 622084107, 843077394, 27741141, 362422166, 442420602, 768992800, 325248989, 340829849, 171980086, 159195872, 321784865, 186363870, 698237690, 554287168, 485333591, 676843695, 5844265, 39192227, 679171093, 473715583, 573334448, 764193382, 282849182, 387397336, 196849811, 677999534, 62996707, 14500736, 310776860, 419536626, 87307919, 472455775, 317244954, 811631127, 790609573, 653925925, 394618933, 297729308, 47040376, 580823623, 299461557, 64376967, 837408223, 45388946, 719027645, 402977974, 463270122, 458188468, 527131116, 308161567, 508652026, 100879078, 315566819, 518770193, 111549113, 700664653, 176170048, 798834409, 326038920, 573703583, 14788922, 43610174, 800891738, 706274108, 77732027, 483192705, 35524016, 165820647, 201886161, 748215965, 183126640, 750840576, 825761569, 232697139, 171339888, 80825639, 69801717, 183852133, 542596659, 541907186, 541349081, 674824000, 167595501, 837601396, 26962491, 183561837, 694393705, 195664674, 196221376, 163684471, 112887015, 239130361, 123940322, 586103482, 572021887, 242733106, 148354832, 16090984, 77165940, 40054413, 793104063, 77941360, 492809472, 329261038, 206410899, 235748093, 20250414, 769712104, 299448360, 208363272, 320273072, 751519729, 49812216, 15555393, 377608418, 194174925, 651731069, 246022929, 287330123, 352781804, 767753054, 775042509, 282051871, 785129864, 806566193, 824923802, 737621696, 258594840, 423784177, 281139535, 737342665, 640504929, 600870079, 7278795, 448727614, 398956466, 596642629, 443985736, 839105525, 452338058, 164852102, 369412785, 790997561, 242592047, 323946614, 800219869, 778231916, 74875914, 687453222, 744452513, 223197712, 653343422, 419151024, 721942219, 554557699, 640423301, 139661319, 730945511, 135923743, 46246364, 673189476, 53216661, 670731587, 49965421, 258557310, 727250707, 809771468, 286789725, 375822046, 677089763, 540384637, 355674102, 464466247, 618618229, 310588539, 505533249, 440107582, 622462098, 89435095, 522581010, 52633279, 849481534, 339131395, 32821106, 43922061, 443894867, 222677069, 752558909, 348218889, 307144172, 792087569, 283208583, 323166507, 632407861, 20627192, 311909568, 547819348, 810552096, 832922511, 185952240, 548996756, 249875044, 581827469, 594612401, 509354825, 166423552, 687725964, 209148616, 549879271, 510851363, 167056706, 557174310, 625671231, 734224509, 276688845, 152189289, 808630010, 607846371, 32918267, 105795598, 728801840, 437474423, 279113987, 35170677, 498972339, 772678200, 706591331, 419062046, 495326753, 205901051, 341374022, 622306802, 168751255, 563195567, 306712791, 748608702, 687852450, 632721857, 748662062, 798532808, 256092068, 169179953, 185883422, 824924986, 716210247, 215935327, 592492227, 542168832, 605142692, 635148696, 112924430, 532882915, 227517455, 149117684, 442508501, 804741501, 351933335, 164867746, 385627452, 807798066, 139006398, 585403267, 118188712, 658789984, 672007948, 101273762, 617047997, 458897276, 237221901, 171668520, 841229618, 538019818, 105003633, 530143116, 407521512, 303064993, 726611147, 666479988, 695880930, 686155504, 568094464, 35168631, 551651993, 652202379, 12978118, 141933777, 391742271, 654845444, 433076480, 193889492, 220765481, 588044078, 203610173, 770210537, 785710798, 226521790, 457487729, 660797072, 387765448, 497033019, 530623331, 88902770, 453228891, 580570531, 35189832, 447068566, 229962341, 321077117, 603424813, 639348348, 379639360, 807944819, 549749317, 360811918, 484706746, 588161579, 119866113, 609282811, 71992819, 197053050, 109443589, 752773396, 305946167, 179632268, 707506523, 564898274, 287611146, 338063332, 204473231, 49214868, 297248037, 694051899, 18164872, 549533505, 392669670, 35097641, 590661970, 262904250, 139454471, 679127985, 584237337, 42088716};

static const int32_t gj[512] = {1, 719012196, 715276703, 715436593, 301183153, 208806801, 853010840, 531579602, 384656176, 818064792, 338175376, 59629139, 177703481, 286785445, 348843899, 443740762, 249158973, 705708775, 747525764, 593722762, 618099317, 261204072, 277753851, 685450188, 94204046, 156226324, 691292513, 801019300, 58426643, 667637271, 494462276, 66121594, 35221899, 525748636, 161434867, 62997639, 469008373, 346520774, 482259919, 409798499, 133075844, 745295810, 11529027, 569797495, 678406247, 772365364, 637949541, 749175355, 334996591, 5933220, 565345218, 113024685, 165890017, 470310936, 459095118, 357134747, 508012594, 131308995, 41513888, 187059594, 771995382, 728222189, 228956714, 588570440, 189113650, 134679071, 814986193, 834846815, 33158092, 197942899, 432358297, 824145345, 768004848, 177575112, 789648289, 75345979, 192825536, 362637955, 601965874, 806155783, 506281008, 49290127, 104443763, 777982333, 97039637, 484116602, 70040119, 661219687, 199704015, 525684245, 50092148, 762926803, 291065678, 279518443, 119080112, 230361814, 760990963, 650961524, 91588722, 334516193, 56826662, 657754458, 447730595, 186058202, 437558103, 585062317, 72517189, 417525423, 103478409, 92619516, 254313011, 397204696, 575622399, 32433294, 186856954, 765725564, 849259727, 483429650, 52570926, 22666672, 167219529, 91925291, 200427778, 349952679, 827704862, 827160331, 488192765, 38255686, 706286880, 455427397, 850602313, 844427850, 495769446, 239314561, 740363440, 478550832, 754061869, 736424562, 755701430, 102465094, 421022223, 792688272, 728223676, 73836837, 15647998, 710093559, 229710899, 529729957, 453710973, 269341183, 276201383, 311350260, 277127909, 397358757, 729707691, 22790425, 837941587, 802979460, 150847013, 356015153, 243415472, 685583551, 518401273, 680796614, 279478927, 547823203, 157601960, 363039316, 381935397, 416427004, 79218444, 553591686, 598985076, 157095041, 429581075, 246075971, 563151163, 262428846, 307486560, 824281139, 4733948, 707444844, 771826735, 849778291, 206802931, 141971378, 835256668, 488133396, 438812422, 281388073, 811770232, 515551941, 330249440, 838728478, 140863325, 68001329, 235721072, 242011575, 777454606, 107776503, 111311816, 77411482, 813524185, 42232756, 62509839, 194671959, 367149872, 417825828, 476246462, 711915335, 105046783, 677496302, 795628818, 855084510, 163864923, 245465395, 53352963, 638416991, 659113059, 626410285, 553232287, 570382144, 224136688, 394093319, 419300717, 222237898, 319373129, 92378512, 229584548, 831868234, 146576901, 307447825, 313679209, 355938645, 2185917, 286714826, 728857243, 71444684, 571633879, 685742471, 421243328, 248214362, 428383766, 24492616, 374664841, 412892818, 525822404, 301011603, 321713313, 536446673, 182555407, 821091376, 300541961, 501682538, 817827275, 713717677, 711088165, 522989901, 296409420, 4802470, 231823369, 320384293, 224421456, 481387092, 90957748, 49716636, 657412695, 540980388, 419033943, 819386718, 38933566, 820886060, 833666055, 28396283, 50110778, 701058317, 840928124, 383547905, 837000189, 830145341, 572354561, 82932656, 294788832, 628051432, 742394824, 271208570, 347305118, 648351512, 395710162, 530445201, 737146438, 795240797, 438910743, 598522177, 281951271, 295651092, 583920005, 553024019, 109095884, 366010284, 625687314, 849585620, 379464425, 17085114, 725457370, 799387113, 576630662, 737705119, 718656599, 697117210, 288912029, 380030966, 813282876, 748286210, 654988817, 730821372, 388916285, 213371932, 166513327, 400787905, 736335377, 126338149, 438427670, 195529885, 495313421, 323604162, 572465576, 169219003, 59945548, 164332157, 667326385, 807410510, 757677750, 675678933, 154841164, 602467164, 421731307, 803845710, 20396355, 586334625, 282808242, 396196103, 604891932, 611741776, 457663814, 392413687, 538087761, 757294430, 271742454, 164101533, 109053124, 460678355, 350748838, 586918112, 790931748, 184084463, 366611333, 273662222, 97833233, 697239417, 644184529, 557686308, 839259265, 12429249, 22397298, 299204292, 497144261, 342733938, 395208180, 779210146, 320445598, 594354551, 437882729, 431904704, 439979015, 464537208, 121525987, 568197609, 483008374, 185246788, 232688804, 654949780, 539600184, 475328768, 51179932, 331702759, 575011109, 691625671, 118248073, 558593577, 499243802, 57116408, 441664218, 55929721, 746011455, 97679711, 256625556, 66159944, 261260852, 471999846, 246446130, 172294978, 677027610, 832739285, 13325767, 579929269, 306719920, 16408181, 23254686, 576762685, 849720831, 799730468, 483700524, 551165624, 637809110, 428963856, 632498923, 109716908, 434775517, 162947704, 369446534, 146512227, 478382836, 640738780, 616023408, 314943387, 761424806, 580502560, 87868612, 350133752, 412864700, 370673770, 730652781, 536297076, 7855230, 401651107, 790269071, 796927664, 430745763, 544465326, 255093935, 392671081, 324106099, 501696809, 75867285, 599730107, 310453022, 855242944, 790461411, 639795332, 95317530, 141026537, 421289332, 487621311, 49354943, 151875985, 138849989, 403732402, 132070808, 136934567, 364392868, 326742523, 575022420, 52325127, 34082256, 570651708, 577267726, 620392401, 82745788, 40004760, 658447669, 3427855, 98328464, 744511346, 34711935, 365273572, 43237830, 596665058, 481799281, 400125906, 836272496, 569485927, 340503621, 792239123, 497679198, 446378577, 490013492, 790500288, 512618574, 288185981, 556917071, 10966996, 294000866, 595677609, 721821841, 116202234, 199977678, 399400684, 751963323, 701187156, 96158605, 371749282, 21621251, 152525383, 358513017, 263106409, 230034594, 482328090, 123942923, 326411423, 708595606, 732920689};

static const int32_t invgj[512] = {1, 123225232, 147550315, 529734498, 732202998, 373817831, 626111327, 593039512, 497632904, 703620538, 834524670, 484396639, 759987316, 154958765, 104182598, 456745237, 656168243, 739943687, 134324080, 260468312, 562145055, 845178925, 299228850, 567959940, 343527347, 65645633, 366132429, 409767344, 358466723, 63906798, 515642300, 286659994, 19873425, 456020015, 374346640, 259480863, 812908091, 490872349, 821433986, 111634575, 757817457, 852718066, 197698252, 816141161, 773400133, 235753520, 278878195, 285494213, 822063665, 803820794, 281123501, 529403398, 491753053, 719211354, 724075113, 452413519, 717295932, 704269936, 806790978, 368524610, 434856589, 715119384, 760828391, 216350589, 65684510, 902977, 545692899, 256415814, 780278636, 354449112, 532039822, 463474840, 601051986, 311680595, 425400158, 59218257, 65876850, 454494814, 848290691, 319848845, 125493140, 485472151, 443281221, 506012169, 768277309, 275643361, 94721115, 541202534, 240122513, 215407141, 377763085, 709633694, 486699387, 693198217, 421370404, 746429013, 223646998, 427182065, 218336811, 304980297, 372445397, 56415453, 6425090, 279383236, 832891235, 839737740, 549426001, 276216652, 842820154, 23406636, 179118311, 683850943, 609699791, 384146075, 594885069, 789985977, 599520365, 758466210, 110134466, 800216200, 414481703, 799029513, 356902119, 297552344, 737897848, 164520250, 281134812, 524443162, 804965989, 380817153, 316545737, 201196141, 623457117, 670899133, 373137547, 287948312, 734619934, 391608713, 416166906, 424241217, 418263192, 261791370, 535700323, 76935775, 460937741, 513411983, 359001660, 556941629, 833748623, 843716672, 16886656, 298459613, 211961392, 158906504, 758312688, 582483699, 489534588, 672061458, 65214173, 269227809, 505397083, 395467566, 747092797, 692044388, 584403467, 98851491, 318058160, 463732234, 398482107, 244404145, 251253989, 459949818, 573337679, 269811296, 835749566, 52300211, 434414614, 253678757, 701304757, 180466988, 98468171, 48735411, 188819536, 691813764, 796200373, 686926918, 283680345, 532541759, 360832500, 660616036, 417718251, 729807772, 119810544, 455358016, 689632594, 642773989, 467229636, 125324549, 201157104, 107859711, 42863045, 476114955, 567233892, 159028711, 137489322, 118440802, 279515259, 56758808, 130688551, 839060807, 476681496, 6560301, 230458607, 490135637, 747050037, 303121902, 272225916, 560494829, 574194650, 257623744, 417235178, 60905124, 118999483, 325700720, 460435759, 207794409, 508840803, 584937351, 113751097, 228094489, 561357089, 773213265, 283791360, 26000580, 19145732, 472598016, 15217797, 155087604, 806035143, 827749638, 22479866, 35259861, 817212355, 36759203, 437111978, 315165533, 198733226, 806429285, 765188173, 374758829, 631724465, 535761628, 624322552, 851343451, 559736501, 333156020, 145057756, 142428244, 38318646, 354463383, 555603960, 35054545, 673590514, 319699248, 534432608, 555134318, 330323517, 443253103, 481481080, 831653305, 427762155, 607931559, 434902593, 170403450, 284512042, 784701237, 127288678, 569431095, 853960004, 500207276, 542466712, 548698096, 709569020, 24277687, 626561373, 763767409, 536772792, 633908023, 436845204, 462052602, 632009233, 285763777, 302913634, 229735636, 197032862, 217728930, 802792958, 610680526, 692280998, 1061411, 60517103, 178649619, 751099138, 144230586, 379899459, 438320093, 488996049, 661473962, 793636082, 813913165, 42621736, 778734439, 744834105, 748369418, 78691315, 614134346, 620424849, 788144592, 715282596, 17417443, 525896481, 340593980, 44375689, 574757848, 417333499, 368012525, 20889253, 714174543, 649342990, 6367630, 84319186, 148701077, 851411973, 31864782, 548659361, 593717075, 292994758, 610069950, 426564846, 699050880, 257160845, 302554235, 776927477, 439718917, 474210524, 493106605, 698543961, 308322718, 576666994, 175349307, 337744648, 170562370, 612730449, 500130768, 705298908, 53166461, 18204334, 833355496, 126438230, 458787164, 579018012, 544795661, 579944538, 586804738, 402434948, 326415964, 626435022, 146052362, 840497923, 782309084, 127922245, 63457649, 435123698, 753680827, 100444491, 119721359, 102084052, 377595089, 115782481, 616831360, 360376475, 11718071, 5543608, 400718524, 149859041, 817890235, 367953156, 28985590, 28441059, 506193242, 655718143, 764220630, 688926392, 833479249, 803574995, 372716271, 6886194, 90420357, 669288967, 823712627, 280523522, 458941225, 601832910, 763526405, 752667512, 438620498, 783628732, 271083604, 418587818, 670087719, 408415326, 198391463, 799319259, 521629728, 764557199, 205184397, 95154958, 625784107, 737065809, 576627478, 565080243, 93219118, 806053773, 330461676, 656441906, 194926234, 786105802, 372029319, 759106284, 78163588, 751702158, 806855794, 349864913, 49990138, 254180047, 493507966, 663320385, 780799942, 66497632, 678570809, 88141073, 32000576, 423787624, 658203022, 822987829, 21299106, 41159728, 721466850, 667032271, 267575481, 627189207, 127923732, 84150539, 669086327, 814632033, 724836926, 348133327, 499011174, 397050803, 385834985, 690255904, 743121236, 290800703, 850212701, 521149330, 106970566, 218196380, 83780557, 177739674, 286348426, 844616894, 110850111, 723070077, 446347422, 373886002, 509625147, 387137548, 793148282, 694711054, 330397285, 820924022, 790024327, 361683645, 188508650, 797719278, 55126621, 164853408, 699919597, 761941875, 170695733, 578392070, 594941849, 238046604, 262423159, 108620157, 150437146, 606986948, 412405159, 507302022, 569360476, 678442440, 796516782, 517970545, 38081129, 471489745, 324566319, 3135081, 647339120, 554962768, 140709328, 140869218, 137133725};

void poly_uniform(poly_k a, const unsigned char *seed)         
{ // Generation of polynomials "a_i"
  unsigned int pos=0, i=0, nbytes = (PARAM_Q_LOG+7)/8;
  unsigned int nblocks=PARAM_GEN_A;
  uint32_t val1, val2, val3, val4, mask = (uint32_t)(1<<PARAM_Q_LOG)-1;
  unsigned char buf[SHAKE128_RATE*PARAM_GEN_A];
  uint16_t dmsp=0;

  cshake128_simple(buf, SHAKE128_RATE*PARAM_GEN_A, dmsp++, seed, CRYPTO_RANDOMBYTES);    
     
  while (i < PARAM_K*PARAM_N) {   
    if (pos > SHAKE128_RATE*nblocks - 4*nbytes) {
      nblocks = 1;
      cshake128_simple(buf, SHAKE128_RATE*nblocks, dmsp++, seed, CRYPTO_RANDOMBYTES);    
      pos = 0;
    } 
    val1  = (*(uint32_t*)(buf+pos)) & mask;
    pos += nbytes;
    val2  = (*(uint32_t*)(buf+pos)) & mask;
    pos += nbytes;
    val3  = (*(uint32_t*)(buf+pos)) & mask;
    pos += nbytes;
    val4  = (*(uint32_t*)(buf+pos)) & mask;
    pos += nbytes;
    if (val1 < PARAM_Q && i < PARAM_K*PARAM_N)
      a[i++] = reduce((int64_t)val1*PARAM_R2_INVN);
    if (val2 < PARAM_Q && i < PARAM_K*PARAM_N)
      a[i++] = reduce((int64_t)val2*PARAM_R2_INVN);
    if (val3 < PARAM_Q && i < PARAM_K*PARAM_N)
      a[i++] = reduce((int64_t)val3*PARAM_R2_INVN);
    if (val4 < PARAM_Q && i < PARAM_K*PARAM_N)
      a[i++] = reduce((int64_t)val4*PARAM_R2_INVN);
  }
}


int32_t reduce(int64_t a)
{ // Montgomery reduction
  int64_t u;

  u = (a*PARAM_QINV) & 0xFFFFFFFF;
  u *= PARAM_Q;
  a += u;
  return (int32_t)(a>>32);
}


int64_t barr_reduce64(int64_t a)
{ // Barrett reduction
  int64_t u = (a*PARAM_BARR_MULT)>>PARAM_BARR_DIV;
  return a - u*PARAM_Q;
}


sdigit_t barr_reduce(sdigit_t a)
{ // Barrett reduction
  digit_t u = ((int64_t)a*PARAM_BARR_MULT)>>PARAM_BARR_DIV;
  return a - (digit_t)u*PARAM_Q;
}


void dgt(poly x)
{  
  int32_t a, sub_re, sub_img;
  int i, index, j, m, window;

  window = 1;
  for(m = 1024; m >= 2; m >>= 1) {
    index = 0;
    for(j = 0; j < m; j += 2) {
      a = gj[index];

      for(i = j; i < PARAM_N; i += (m << 1)) {
        sub_re = x[i] - x[i+m];
        sub_img = x[i+1] - x[i+m+1];
        
        x[i] = barr_reduce(x[i] + x[i+m]);
        x[i+1] = barr_reduce(x[i+1] + x[i+m+1]);

        x[i+m] = reduce((int64_t)a * sub_re);
        x[i+m+1] = reduce((int64_t)a * sub_img);        
      }
      index += window;
    }
    window <<= 1;
  }
}


void idgt(poly x)
{
  int i, index, j, m, window;
  int32_t a, mul_re, mul_img;

  window = (1024 >> 1);
  for(m = 2; m <= 1024; m <<= 1) {
    index = 0;
    for(j = 0; j < m; j += 2) {
      a = invgj[index];
      
      for(i = j; i < PARAM_N; i += (m << 1)) {
        mul_re = reduce((int64_t)x[i+m] * a);
        mul_img = reduce((int64_t)x[i+m+1] * a);
        
        x[i+m] = x[i] - mul_re; // Omit reduction, be lazy
        x[i+m+1] = x[i+1] - mul_img; // Omit reduction, be lazy

        x[i] = x[i] + mul_re - PARAM_Q;
        x[i] += (x[i] >> (RADIX32-1)) & PARAM_Q;
        
        x[i+1] = x[i+1] + mul_img - PARAM_Q;
        x[i+1] += (x[i+1] >> (RADIX32-1)) & PARAM_Q;
      }
      index += window;
    }
    window >>= 1;       

    m <<= 1;

    index = 0;
    for(j = 0; j < m; j += 2) {
      a = invgj[index];
      
      for(i = j; i < PARAM_N; i += (m << 1)) {
        mul_re = reduce((int64_t)x[i+m] * a);
        mul_img = reduce((int64_t)x[i+m+1] * a);
        
        x[i+m] = barr_reduce(x[i] - mul_re);
        x[i+m+1] = barr_reduce(x[i+1] - mul_img);

        x[i] = barr_reduce(x[i] + mul_re);
        x[i+1] = barr_reduce(x[i+1] + mul_img);        
      }
      index += window;
    }
    window >>= 1;        

  }
}

static void poly_pointwise(poly result, const poly x, const poly y)
{ // Pointwise polynomial multiplication result = x.y

  for (int i=0; i<PARAM_N; i++)
    result[i] = reduce((int64_t)x[i]*y[i]);
}


void poly_dgt(poly x_dgt, const poly x)
{

  int i, j;

  j = 0;
  for(i = 0; i < PARAM_N; i+=2) {             
      x_dgt[i] = reduce(
        (int64_t)x[j] * nthroots[i] - 
        (int64_t)x[1024+j] * nthroots[i+1]);
      
      x_dgt[i+1] = reduce(
        (int64_t)x[j] * nthroots[i+1] + 
        (int64_t)x[1024+j] * nthroots[i]);
      j++;
  } 

  dgt(x_dgt);
}


void poly_mul(poly result, const poly a, const poly b)
{ /* It is assumed that both signals are already in the DGT domain. 
     The DGT counterpart of poly_b was computed in sign.c. */
  
  poly mul;
  int i, j;

  /* Calculating the point-wise multiplication of input signals */
  for(i = 0; i < PARAM_N; i+=2) {             
    mul[i] = reduce(
      (int64_t)a[i] * b[i] - 
      (int64_t)a[i+1] * b[i+1]);
    mul[i+1] = reduce(
      (int64_t)a[i] * b[i+1] + 
      (int64_t)a[i+1] * b[i]);
  }

  /* Recovering the multiplication result in Z[x]/<x^n+1> */
  idgt(mul);

  /* Removing the twisting factors and writing the result from the Gaussian integer to the polynomial form */
  j = 0;
  for(i = 0; i < PARAM_N; i+=2) {
      result[j] = reduce(
        (int64_t)mul[i] * invnthroots[i] - 
        (int64_t)mul[i+1] * invnthroots[i+1]);
      result[j+1024] = reduce(
        (int64_t)mul[i] * invnthroots[i+1] + 
        (int64_t)mul[i+1] * invnthroots[i]);
      j++;
  }
}


void poly_add(poly result, const poly x, const poly y)
{ // Polynomial addition result = x+y

    for(int i=0; i<PARAM_N; i++)
      result[i] = x[i] + y[i];
}


void poly_add_correct(poly result, const poly x, const poly y)
{ // Polynomial addition result = x+y with correction

    for (int i=0; i<PARAM_N; i++) {
      result[i] = x[i] + y[i];
      result[i] += (result[i] >> (RADIX32-1)) & PARAM_Q;    // If result[i] < 0 then add q
      result[i] -= PARAM_Q;
      result[i] += (result[i] >> (RADIX32-1)) & PARAM_Q;    // If result[i] >= q then subtract q
    }
}


void poly_sub(poly result, const poly x, const poly y)
{ // Polynomial subtraction result = x-y

    for (int i=0; i<PARAM_N; i++)
      result[i] = x[i] - y[i];
}    


void poly_sub_reduce(poly result, const poly x, const poly y)
{ // Polynomial subtraction result = x-y

    for (int i=0; i<PARAM_N; i++)
      result[i] = (int32_t)barr_reduce(x[i] - y[i]);
}


/********************************************************************************************
* Name:        sparse_mul8
* Description: performs sparse polynomial multiplication
* Parameters:  inputs:
*              - const unsigned char* s: part of the secret key
*              - const uint32_t pos_list[PARAM_H]: list of indices of nonzero elements in c
*              - const int16_t sign_list[PARAM_H]: list of signs of nonzero elements in c
*              outputs:
*              - poly prod: product of 2 polynomials
*
* Note: pos_list[] and sign_list[] contain public information since c is public
*********************************************************************************************/
void sparse_mul8(poly prod, const unsigned char *s, const uint32_t pos_list[PARAM_H], const int16_t sign_list[PARAM_H])
{
  int i, j, pos;
  int8_t *t = (int8_t*)s;

  for (i=0; i<PARAM_N; i++)
    prod[i] = 0;

  for (i=0; i<PARAM_H; i++) {
    pos = pos_list[i];
    for (j=0; j<pos; j++) {
        prod[j] = prod[j] - sign_list[i]*t[j+PARAM_N-pos];
    }
    for (j=pos; j<PARAM_N; j++) {
        prod[j] = prod[j] + sign_list[i]*t[j-pos];
    }
  }
}


/********************************************************************************************
* Name:        sparse_mul32
* Description: performs sparse polynomial multiplication 
* Parameters:  inputs:
*              - const int32_t* pk: part of the public key
*              - const uint32_t pos_list[PARAM_H]: list of indices of nonzero elements in c
*              - const int16_t sign_list[PARAM_H]: list of signs of nonzero elements in c
*              outputs:
*              - poly prod: product of 2 polynomials
*********************************************************************************************/
void sparse_mul32(poly prod, const int32_t *pk, const uint32_t pos_list[PARAM_H], const int16_t sign_list[PARAM_H])
{
  int i, j, pos;
  int64_t temp[PARAM_N] = {0};
  
  for (i=0; i<PARAM_H; i++) {
    pos = pos_list[i];
    for (j=0; j<pos; j++) {
        temp[j] = temp[j] - sign_list[i]*pk[j+PARAM_N-pos];
    }
    for (j=pos; j<PARAM_N; j++) {
        temp[j] = temp[j] + sign_list[i]*pk[j-pos];
    }
  }
  for (i=0; i<PARAM_N; i++)
    prod[i] = (int32_t)barr_reduce64(temp[i]);
}
